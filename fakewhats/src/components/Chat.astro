–∫–ª–∏–∫---
import { COPY } from '../content/copy';
import OrderForm from './OrderForm.astro';
import ReturnPopup from './ReturnPopup.astro';
import FormReturnPopup from './FormReturnPopup.astro';
import TimeSelectionPopup from './TimeSelectionPopup.astro';
import DomonetkaForm from './DomonetkaForm.astro';
import VSLExitPopup from './VSLExitPopup.astro';
import ReturnVisitPopup from './ReturnVisitPopup.astro';

import DiscountButton from './DiscountButton.astro';
import { siteConfig } from '../config/site-config';
const { messages, form } = COPY;
  const autoPostbackMs = form.autoPostbackSeconds ? form.autoPostbackSeconds * 1000 : 180000;
---

<div class="container">
  <slot name="header" />
  <div class="chat" id="chat">
    <!-- Encryption Message -->
    <div class="bubble encryption">
      üîí {siteConfig.texts.chatMessages.encryptionMessage}
    </div>

    <!-- Urgent Message -->
    <div class="bubble urgent">
      <strong>{siteConfig.texts.chatMessages.urgentMessage}</strong><br><br>
      {siteConfig.texts.chatMessages.problemMessage}
    </div>

    <!-- VSL Card -->
    <div class="bubble vsl-bubble">
      <div class="vsl-card">
        <div class="vsl-thumb">
                      <video id="vslVideoInline" src={siteConfig.images.videos.chatVsl} muted loop playsinline preload="metadata" loading="lazy" class="vsl-video" data-popup-start={siteConfig.settings.vslPopupStartTime} data-popup-end={siteConfig.settings.vslPopupEndTime} data-video-src={siteConfig.images.videos.chatVsl} onloadstart="console.log('Video loading started')" onloadeddata="console.log('Video data loaded')" oncanplay="console.log('Video can play, duration:', this.duration)" onerror="console.log('Video error:', this.error)"></video>
          <div class="vsl-overlay">
            <!-- –ó–µ–ª–µ–Ω–∞—è –º–∏–≥–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ -->
            <div class="vsl-sound-btn" id="vslPlayBtn" style="cursor: pointer; z-index: 5; pointer-events: auto;">
              <div class="sound-btn-content">
                <div class="sound-btn-text-top">{siteConfig.texts.buttons.enableSound}</div>
                <div class="sound-btn-text-bottom">{siteConfig.texts.buttons.saveErection}</div>
              </div>
            </div>
            
            <!-- –ü—Ä–æ—Å—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ–π (—Å–∫—Ä—ã—Ç–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ) -->
            <button id="vslPlayBtnSimple" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: transparent; border: none; width: 200px; height: 80px; cursor: pointer; z-index: 7; display: none;"></button>
            
            <!-- –ú–∞–ª–µ–Ω—å–∫–∞—è –∫–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ (—Å–∫—Ä—ã—Ç–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ) -->
            <button id="vslMuteBtn" style="position: absolute; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 6; font-size: 16px; display: none; pointer-events: auto;">üîá</button>
            
            <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–Ω–∞—á–∞–ª–∞" -->
            <button id="vslRestartBtn" style="position: absolute; top: 10px; right: 90px; background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 8; font-size: 16px; display: none; pointer-events: auto;" title="–ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–Ω–∞—á–∞–ª–∞">‚Üª</button>
            
            <!-- –ö—Ä–µ—Å—Ç–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è VSL -->
            <button id="vslCloseBtn" style="position: absolute; top: 10px; right: 50px; background: rgba(0, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; z-index: 8; font-size: 18px; display: none; pointer-events: auto;">‚úï</button>
            
            <!-- –ü–æ–ø–∞–ø –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ VSL -->
            <div id="vslMidPopup" class="vsl-mid-popup" style="display: none;">
              <!-- –ó–µ–ª–µ–Ω–∞—è –ø–ª–∞—à–∫–∞ —Å–≤–µ—Ä—Ö—É -->
              <div class="vsl-mid-banner" onclick="if(window.showOrderForm) window.showOrderForm();" style="cursor: pointer;">
                <div class="vsl-mid-vignette"></div>
                <div>{siteConfig.texts.popups.vslMidPopup.title}</div>
                <div style="font-size: 14px; margin-top: 5px;">{siteConfig.texts.popups.vslMidPopup.subtitle}</div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- Discount Button Message (—Å–∫—Ä—ã—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ) -->
    <div class="discount-message" style="display: none;">
      <div class="product-image">
        <img src={siteConfig.images.chatImages.productImage} alt={siteConfig.productName} loading="lazy" />
      </div>
      <div class="discount-content">
        <div class="discount-text">
          <p><strong>{siteConfig.texts.banners.exclusiveOffer}</strong> –ò–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—Å –¥–æ—Å—Ç—É–ø–Ω–∞</p>
          <p>{siteConfig.texts.banners.actionPrice} {siteConfig.productName}!</p>
          <p>{siteConfig.texts.banners.leaveRequest}</p>
        </div>
        <button id="getDiscountBtn" class="discount-btn">
          {siteConfig.texts.buttons.getSpecialOffer}
        </button>
      </div>
    </div>



    <!-- Auto Message with Product (shown after 3 minutes or on minimize) -->
    <div class="auto-message" id="autoMessage" style="display: none;">
      <div class="auto-message-content">
        <div class="product-image">
          <img src={siteConfig.images.chatImages.productImage} alt={siteConfig.productName} loading="lazy" />
        </div>
        <div class="message-text">
          <p><strong>{siteConfig.texts.banners.exclusiveOffer}</strong> –ò–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—Å –¥–æ—Å—Ç—É–ø–Ω–∞</p>
          <p>{siteConfig.texts.banners.actionPrice} {siteConfig.productName}!</p>
          <p>{siteConfig.texts.banners.leaveRequest}</p>
        </div>
      </div>
    </div>

    <!-- Auto Discount Button (separate from message) -->
    <div class="bubble auto-discount-container" id="autoDiscountContainer" style="display: none;">
      <button class="auto-discount-btn" id="autoDiscountBtn">
        {siteConfig.texts.buttons.getSpecialOffer}
      </button>
    </div>

    <!-- –ü–æ–ø–∞–ø –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ VSL -->
    <div id="vslCloseChoicePopup" class="vsl-close-choice-popup" style="display: none;">
      <div class="vsl-close-choice-content">
        <h3>{siteConfig.texts.popups.vslCloseChoicePopup.title}</h3>
        <div class="vsl-close-choice-buttons">
          <button id="continueWatchingChoice" class="btn-primary">{siteConfig.texts.popups.vslCloseChoicePopup.continueButton}</button>
          <button id="returnToChatChoice" class="btn-secondary">{siteConfig.texts.popups.vslCloseChoicePopup.returnToChatButton}</button>
        </div>
      </div>
    </div>





  </div>

  <!-- PWA Modals (positioned relative to chat container) -->
  <div class="pwa-modal" id="orderFormModal" style="display: none;">
    <div class="pwa-modal-backdrop" id="orderFormBackdrop"></div>
    <div class="pwa-modal-content">
      <div class="pwa-modal-header">
        <div class="pwa-modal-handle"></div>
        <button class="pwa-modal-close" id="closeOrderFormModal">‚úï</button>
      </div>
      
      <div class="pwa-modal-body">
        <!-- Form Header -->
        <div class="form-header">
          <h2 class="form-title">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ UROXEL</h2>
        </div>

        <!-- Product Image -->
        <div class="product-image-section">
          <img src="/Uroxel_form.png" alt="UROXEL Triple Action" class="product-image" loading="lazy" />
        </div>

        <!-- Timer -->
        <div class="timer-section">
          <div class="timer-badge">
            <span id="orderTimer">04:19</span>
          </div>
        </div>

        <!-- Form Fields -->
        <form id="orderLeadForm" class="order-form-fields">
          <div class="form-group">
            <label for="orderName" class="field-label">{siteConfig.texts.forms.orderForm.namePlaceholder}</label>
            <input type="text" id="orderName" name="name" class="form-input" placeholder={siteConfig.texts.forms.orderForm.namePlaceholder} required>
          </div>

          <div class="form-group">
            <label for="orderPhone" class="field-label">{siteConfig.texts.forms.orderForm.phonePlaceholder}</label>
                          <input type="tel" id="orderPhone" name="phone" class="form-input" placeholder={siteConfig.texts.forms.orderForm.phonePlaceholder} required>
          </div>

                      <button type="submit" class="submit-btn">{siteConfig.texts.buttons.orderCall}</button>

          <div class="form-disclaimer">
            {siteConfig.legal.specialPriceDisclaimer} {siteConfig.legal.timerDisclaimer} {siteConfig.legal.mexicoOnly} {siteConfig.legal.consultationDisclaimer}
          </div>

          <!-- –ü–ª–∞—à–∫–∞ —Å –æ—Ç–∑—ã–≤–∞–º–∏ –º—É–∂—á–∏–Ω -->
          <div class="reviews-banner">
            <div class="reviews-text">
              {siteConfig.texts.banners.reviewsBanner.split(', ').slice(0, 1).join(', ')}<br>
              {siteConfig.texts.banners.reviewsBanner.split(', ').slice(1, 2).join(', ')}<br>
              {siteConfig.texts.banners.reviewsBanner.split(', ').slice(2).join(', ')}
            </div>
          </div>

          <!-- –û—Ç–∑—ã–≤—ã -->
          <div class="reviews-section">
            <!-- –ü–µ—Ä–≤—ã–π –æ—Ç–∑—ã–≤ (–ê–Ω—Ç–æ–Ω–∏–æ) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback1.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback1.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback1.name} - {siteConfig.reviews.feedback1.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback1.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback1.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback1.rating}.0</span>
                </div>
              </div>
            </div>

            <!-- –í—Ç–æ—Ä–æ–π –æ—Ç–∑—ã–≤ (–ö–∞—Ä–ª–æ—Å) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback2.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback2.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback2.name} - {siteConfig.reviews.feedback2.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback2.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback2.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback2.rating}.0</span>
                </div>
              </div>
            </div>

            <!-- –¢—Ä–µ—Ç–∏–π –æ—Ç–∑—ã–≤ (–ê–º–∞–ª–∏—è) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback3.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback3.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback3.name} - {siteConfig.reviews.feedback3.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback3.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback3.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback3.rating}.0</span>
                </div>
              </div>
            </div>

            <!-- –ß–µ—Ç–≤–µ—Ä—Ç—ã–π –æ—Ç–∑—ã–≤ (–ê–ª–æ–Ω—Å–æ) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback4.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback4.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback4.name} - {siteConfig.reviews.feedback4.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback4.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback4.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback4.rating}.0</span>
                </div>
              </div>
            </div>

            <!-- –ü—è—Ç—ã–π –æ—Ç–∑—ã–≤ (–ì—É—Å—Ç–∞–≤–æ) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback5.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback5.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback5.name} - {siteConfig.reviews.feedback5.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback5.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback5.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback5.rating}.0</span>
                </div>
              </div>
            </div>

            <!-- –®–µ—Å—Ç–æ–π –æ—Ç–∑—ã–≤ (–ò–≥–Ω–∞—Å–∏–æ) -->
            <div class="review-item">
              <div class="review-images single">
                <div class="review-image">
                  <img src={siteConfig.reviews.feedback6.image} alt={`${siteConfig.productName} –æ—Ç–∑—ã–≤ ${siteConfig.reviews.feedback6.name}`} loading="lazy">
                </div>
              </div>
              <div class="review-content">
                <div class="review-text">{siteConfig.reviews.feedback6.name} - {siteConfig.reviews.feedback6.text}</div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.reviews.feedback6.rating)}{'‚òÜ'.repeat(5 - siteConfig.reviews.feedback6.rating)}</span>
                  <span class="rating-score">{siteConfig.reviews.feedback6.rating}.0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
          <div class="text-reviews-section">
            <!-- –û—Ç–∑—ã–≤ 1 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">{siteConfig.textReviews.review1.name}</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">{'‚òÖ'.repeat(siteConfig.textReviews.review1.rating)}{'‚òÜ'.repeat(5 - siteConfig.textReviews.review1.rating)}</span>
                  <span class="rating-score">{siteConfig.textReviews.review1.rating}.0</span>
                </div>
              </div>
              <div class="review-title">{siteConfig.textReviews.review1.title}</div>
              <div class="review-date">{siteConfig.textReviews.review1.date}</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">{siteConfig.textReviews.review1.text}</div>
              {siteConfig.textReviews.review1.helpful && <div class="review-helpful">{siteConfig.textReviews.review1.helpful}</div>}
            </div>

            <!-- –û—Ç–∑—ã–≤ 2 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Carlos</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  <span class="rating-score">5.0</span>
                </div>
              </div>
              <div class="review-title">Buen producto</div>
              <div class="review-date">Comentado en M√©xico el 21 de abril de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Estoy muy conforme con el producto</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 3 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Elmer HRmo</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                  <span class="rating-score">4.0</span>
                </div>
              </div>
              <div class="review-title">Buen producto</div>
              <div class="review-date">Comentado en M√©xico el 11 de agosto de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Buen producto</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 4 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Roberto Soriano D√°vila</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  <span class="rating-score">5.0</span>
                </div>
              </div>
              <div class="review-title">Seriedad del proveedor.</div>
              <div class="review-date">Comentado en M√©xico el 9 de noviembre de 2024</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Muy buen producto, empez√≥ a actuar desde la primera toma, contiene elementos muy valiosos como el zinc, ya que la pr√≥stata es el √≥rgano que contiene 10 veces m√°s Zinc que cualquier otro √≥rgano, tambi√©n el licopeno que se usa para combatir el c√°ncer, as√≠ como otros productos valiosos como el ciruelo africano y la ortiga que han sido probados para desinflamar la pr√≥stata. Lo recomiendo ampliamente.</div>
              <div class="review-helpful">A 4 personas les result√≥ √∫til</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 5 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Gerardo ponce lopez</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  <span class="rating-score">5.0</span>
                </div>
              </div>
              <div class="review-title">MUY BIEN</div>
              <div class="review-date">Comentado en M√©xico el 20 de junio de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">LLEG√ì BIEN GRACIAS</div>
              <div class="review-helpful">A 2 personas les result√≥ √∫til</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 6 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Cliente de Kindle</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
                  <span class="rating-score">4.0</span>
                </div>
              </div>
              <div class="review-title">Excelente</div>
              <div class="review-date">Comentado en M√©xico el 4 de mayo de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Ya voy por la quinta lata. ¬°El efecto es mejor de lo prometido!</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 7 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">GABRIEL MU√ëOZ NU√ëEZ</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  <span class="rating-score">5.0</span>
                </div>
              </div>
              <div class="review-title">Gracias</div>
              <div class="review-date">Comentado en M√©xico el 7 de junio de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Gracias</div>
            </div>

            <!-- –û—Ç–∑—ã–≤ 8 -->
            <div class="text-review-item">
              <div class="review-header">
                <div class="reviewer-info">
                  <div class="reviewer-avatar">üë§</div>
                  <div class="reviewer-name">Ram√≥n N√∫√±ez-Doval</div>
                </div>
                <div class="review-rating">
                  <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                  <span class="rating-score">5.0</span>
                </div>
              </div>
              <div class="review-title">Uroxel es un buen producto</div>
              <div class="review-date">Comentado en M√©xico el 16 de abril de 2025</div>
              <div class="review-verified">Compra verificada</div>
              <div class="review-text">Es un buen producto como se nos hab√≠a anunciado.</div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="pwa-modal" id="callBookingModal" style="display: none;">
    <div class="pwa-modal-backdrop" id="callBookingBackdrop"></div>
    <div class="pwa-modal-content">
      <div class="pwa-modal-header">
        <div class="pwa-modal-handle"></div>
        <button class="pwa-modal-close" id="closeCallBookingModal">‚úï</button>
      </div>
      
      <div class="pwa-modal-body">
        <!-- Product Image -->
        <div class="product-image-section">
          <img src="/Uroxel_form.png" alt="UROXEL Triple Action" class="product-image" loading="lazy" />
        </div>

        <div class="call-to-action">
          <h3 class="call-title">{siteConfig.texts.headers.bookCallTitle}</h3>
                      <p class="call-subtitle">{siteConfig.texts.headers.bookCallSubtitle}</p>
        </div>

        <div class="time-selection">
          <select id="callTime" class="time-dropdown">
            <option value="–ü—Ä—è–º–æ —Å–µ–π—á–∞—Å">–ü—Ä—è–º–æ —Å–µ–π—á–∞—Å</option>
            <option value="5 –º–∏–Ω—É—Ç">5 –º–∏–Ω—É—Ç</option>
            <option value="15 –º–∏–Ω—É—Ç">15 –º–∏–Ω—É—Ç</option>
            <option value="30 –º–∏–Ω—É—Ç">30 –º–∏–Ω—É—Ç</option>
          </select>
        </div>

                  <button id="callSubmitBtn" class="call-submit-btn">{siteConfig.texts.buttons.orderCall}</button>
        <button id="backToOrderBtn" class="back-btn-chat">{siteConfig.texts.buttons.backToOrder}</button>
      </div>
    </div>
  </div>

  

    <!-- Chat Input (outside of chat container) -->
    <div class="chat-input">
    <button class="input-btn">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
    </button>
    <div class="input-field-container">
      <input type="text" class="chat-input-field" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" />
      <button class="emoji-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 11c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0C9.33 11 10 10.33 10 9.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
        </svg>
      </button>
    </div>
    <div class="input-actions">
      <button class="action-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
        </svg>
      </button>
      <button class="action-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12m-3.2 0a3.2 3.2 0 1 1 6.4 0a3.2 3.2 0 1 1 -6.4 0"/>
          <path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
        </svg>
      </button>
      <button class="action-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ -->
<div id="fullscreenPlayer" class="fullscreen-player" style="display: none;">
  <div class="fullscreen-player-content">
    <video id="fullscreenVideo" src={siteConfig.images.videos.chatVsl} controls playsinline preload="none" controlsList="nodownload nofullscreen noremoteplayback"></video>
    <button id="fullscreenCloseBtn" class="fullscreen-close-btn" style="z-index: 1010;">‚úï</button>
    
    <!-- –ü–æ–ø–∞–ø –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ VSL (—Å–∫—Ä—ã—Ç –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ) -->
    <div id="fullscreenVslMidPopup" class="fullscreen-vsl-mid-popup" style="display: none;">
      <!-- –ó–µ–ª–µ–Ω–∞—è –ø–ª–∞—à–∫–∞ —Å–≤–µ—Ä—Ö—É -->
      <div class="fullscreen-vsl-mid-banner" onclick="showOrderFormModal();" style="cursor: pointer;">
        <div class="fullscreen-vsl-mid-vignette"></div>
        <div>{siteConfig.texts.popups.vslMidPopup.title}</div>
        <div style="font-size: 14px; margin-top: 5px;">{siteConfig.texts.popups.vslMidPopup.subtitle}</div>
      </div>
    </div>
  </div>
</div>

<!-- Main VSL Popup -->
<!-- –ü–æ–ø–∞–ø —Å –≤–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω - –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è -->

<!-- Return Popup Component -->
<ReturnPopup />

<!-- Form Return Popup Component -->
<FormReturnPopup />

<!-- Time Selection Popup Component -->
<TimeSelectionPopup />

<!-- Order Form Component (—Å–∫—Ä—ã—Ç, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –≤ —á–∞—Ç–µ) -->
<!-- <OrderForm /> -->

  <!-- Domonetka Form Component -->
  <DomonetkaForm />
  
  <!-- VSL Start Popup Component -->
  
  
  <!-- VSL Exit Popup Component -->
  <!-- <VSLExitPopup /> -->
  
  <!-- Return Visit Popup Component -->
  <ReturnVisitPopup />

<script>
  const openVsl = document.getElementById('openVsl');
  // const popup = document.getElementById('popup'); // –£–¥–∞–ª–µ–Ω
  // const closePopup = document.getElementById('closePopup'); // –£–¥–∞–ª–µ–Ω
  // const video = document.getElementById('vslVideo'); // –£–¥–∞–ª–µ–Ω
  const floatingForm = document.getElementById('floatingForm');
  const minimizeBtn = document.getElementById('minimizeBtn');
  const minimizedBadge = document.getElementById('minimizedBadge');
  const leadForm = document.getElementById('leadForm');
  const calltime = document.getElementById('calltime');

  let postbackTimeoutId;
  let videoStartTime = 0;
  let hasShownForm = false;

  function toggleVslSound() {
    const video = document.getElementById('vslVideoInline');
    const playBtn = document.getElementById('vslPlayBtn');
    const playBtnSimple = document.getElementById('vslPlayBtnSimple');
    const muteBtn = document.getElementById('vslMuteBtn');
    const closeBtn = document.getElementById('vslCloseBtn');
    
    if (video) {
      if (video.muted) {
        // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
        video.muted = false;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        if (playBtn) playBtn.style.display = 'none';
        if (playBtnSimple) playBtnSimple.style.display = 'none';
        if (muteBtn) {
          muteBtn.style.display = 'block';
          muteBtn.textContent = 'üîá';
        }
        if (closeBtn) closeBtn.style.display = 'block';
      } else {
        // –í—ã–∫–ª—é—á–∞–µ–º –∑–≤—É–∫
        video.muted = true;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        if (playBtn) playBtn.style.display = 'flex';
        if (playBtnSimple) playBtnSimple.style.display = 'block';
        if (muteBtn) muteBtn.style.display = 'none';
        if (closeBtn) closeBtn.style.display = 'none';
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–µ–æ –≤ ReturnPopup –±–µ–∑ –∫–Ω–æ–ø–æ–∫
  function openVideoInReturnPopup() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º ReturnPopup
    if (window.showReturnPopup) {
      window.showReturnPopup();
      
      // –°—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏ —Ç–µ–∫—Å—Ç
      setTimeout(function() {
        const textOverlay = document.querySelector('.vsl-text-overlay');
        const vignette = document.querySelector('.vsl-vignette');
        
        if (textOverlay) {
          textOverlay.style.display = 'none';
        }
        if (vignette) {
          vignette.style.display = 'none';
        }
        
        // –£–±–∏—Ä–∞–µ–º –∫—É—Ä—Å–æ—Ä pointer —Å –≤–∏–¥–µ–æ
        const video = document.getElementById('returnVslVideo');
        if (video) {
          video.style.cursor = 'default';
        }
      }, 100);
    }
  }
  
  function openPopup() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º VSL –≤ —á–∞—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ø–∞–ø–∞
    if (window.stopChatVsl) {
      window.stopChatVsl();
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —Å –≤—ã–±–æ—Ä–æ–º –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–µ–æ
    if (window.showReturnPopup) {
      window.showReturnPopup();
    }
  }

  // function closePopupAndShowForm() {
  //   // –£–¥–∞–ª–µ–Ω–∞ - –ø–æ–ø–∞–ø –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  // }
  
  hasShownForm = true;
  scheduleAutoPostback();

  function minimizeForm() {
    floatingForm.dataset.minimized = 'true';
    floatingForm.style.display = 'none';
    minimizedBadge.style.display = 'inline-flex';
  }

  function expandForm() {
    floatingForm.dataset.minimized = 'false';
    floatingForm.style.display = 'block';
    minimizedBadge.style.display = 'none';
  }

  function scheduleAutoPostback() {
    // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞—è–≤–æ–∫
    clearTimeout(postbackTimeoutId);
  }

  async function sendPostback(extra={}) {
    const formData = new FormData(leadForm);
    const payload = {
      ktDomain: "uniaffshark.com",
      ktCampaignId: 10314,
      leadName: formData.get('name') || '',
      phone: formData.get('phone') || '',
      calltime: formData.get('calltime') || '',
      videoWatchTime: videoStartTime ? Math.floor((Date.now() - videoStartTime) / 1000) : 0,
      ...extra,
      ts: Date.now(),
      ua: navigator.userAgent
    };
    
    // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å (–¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞)
    console.log('[UROXEL Lead]', {
      serverTimestamp: new Date().toISOString(),
      ktDomain: payload.ktDomain,
      ktCampaignId: payload.ktCampaignId,
      leadName: payload.leadName,
      phone: payload.phone,
      calltime: payload.calltime,
      reason: payload.reason,
      videoWatchTime: payload.videoWatchTime,
      userAgent: payload.ua,
      clientTimestamp: payload.ts
    });
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
    // –ù–∞–ø—Ä–∏–º–µ—Ä: Google Analytics, Facebook Pixel, –≤–Ω–µ—à–Ω–∏–µ CRM –∏ —Ç.–¥.
    console.log('üìä –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ CRM:', payload);
  }

  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ API
  async function sendLeadToAPI(leadData, action) {
    const apiUrl = "https://api.pwa.uniaffcrm.com/v1/add_lead";
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è API
    const apiData = {
      ktDomain: leadData.ktDomain || "uniaffshark.com",
      ktCampaignId: leadData.ktCampaignId || 10314,
      leadName: leadData.leadName || leadData.name,
      phone: leadData.phone,
      calltime: leadData.calltime,
    };
    
    try {
      console.log(`üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ API (${action}):`, apiData);
      
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(apiData)
      });
      
      if (response.ok) {
        const result = await response.json();
        console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ API (${action}):`, result);
        return { success: true, data: result };
      } else {
        console.error(`‚ùå –û—à–∏–±–∫–∞ API (${action}):`, response.status, response.statusText);
        return { success: false, error: `HTTP ${response.status}: ${response.statusText}` };
      }
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ API (${action}):`, error);
      return { success: false, error: error.message };
    }
  }

  // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–∑–∞–º–µ–Ω–∞ API)
  function logLeadData(leadData, action) {
    console.log(`[UROXEL Lead - ${action}]`, {
      serverTimestamp: new Date().toISOString(),
      ktDomain: leadData.ktDomain || "uniaffshark.com",
      ktCampaignId: leadData.ktCampaignId || 10314,
      leadName: leadData.leadName || leadData.name,
      phone: leadData.phone,
      calltime: leadData.calltime,
      reason: leadData.reason || action,
      videoWatchTime: leadData.videoWatchTime,
      userAgent: leadData.userAgent,
      clientTimestamp: leadData.ts || Date.now()
    });
    console.log(`üìä –î–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (${action}) –≥–æ—Ç–æ–≤—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ CRM:`, leadData);
  }

  // Event Listeners
  // openVsl?.addEventListener('click', (e) => { 
  //   e.preventDefault(); 
  //   openPopup(); 
  // });

  // closePopup?.addEventListener('click', () => { 
  //   closePopupAndShowForm(); 
  // });

  // popup?.addEventListener('click', (e) => { 
  //   if (e.target === popup) { 
  //     closePopupAndShowForm(); 
  //   } 
  // });

  minimizeBtn?.addEventListener('click', () => { 
    minimizeForm(); 
  });

  minimizedBadge?.addEventListener('click', () => { 
    expandForm(); 
  });

  calltime?.addEventListener('change', () => { 
    // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫—É
  });

  leadForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearTimeout(postbackTimeoutId);
    await sendPostback({ reason: 'submit' });
    minimizeForm();
    alert('–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.');
  });

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  console.log('üîç Chat.astro: Checking localStorage for savedVideoTime...');
  const savedTimeFromStorage = localStorage.getItem('savedVideoTime');
  console.log('üîç Chat.astro: savedTimeFromStorage:', savedTimeFromStorage);
  console.log('üîç Chat.astro: All localStorage keys:', Object.keys(localStorage));
  
  if (savedTimeFromStorage) {
    const savedTime = parseFloat(savedTimeFromStorage);
    console.log('üîç Chat.astro: Found saved time:', savedTime, 'seconds');
    if (savedTime > 10) {
      console.log('üîç Chat.astro: Time > 10 seconds, should show return popup');
    }
  } else {
    console.log('üîç Chat.astro: No saved time found');
  }

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –≤–∏–¥–µ–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É—Ö–æ–¥–∞
  document.addEventListener('visibilitychange', () => {
    const video = document.getElementById('vslVideoInline');
    const fullscreenVideo = document.getElementById('fullscreenVideo');
    
    if (document.hidden) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ (—Ç–æ–ª—å–∫–æ –≤ savedChatVideoTime)
      if (video && !video.paused) {
        if (window.saveVideoTime) {
          window.saveVideoTime();
        }
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ (–≤ savedVideoTime –¥–ª—è –ø–æ–ø–∞–ø–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞)
      if (fullscreenVideo && !fullscreenVideo.paused && fullscreenVideo.currentTime > 0) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∞–º–æ–µ –ø–æ–∑–¥–Ω–µ–µ
        const chatVideo = document.getElementById('vslVideoInline');
        const returnVideo = document.getElementById('returnVslVideo');
        const returnVisitVideo = document.getElementById('returnVisitVideo');
        
        let maxTime = fullscreenVideo.currentTime;
        let maxSource = 'fullscreen';
        
        if (chatVideo && chatVideo.currentTime > maxTime) {
          maxTime = chatVideo.currentTime;
          maxSource = 'chat';
        }
        
        if (returnVideo && returnVideo.currentTime > maxTime) {
          maxTime = returnVideo.currentTime;
          maxSource = 'return';
        }
        
        if (returnVisitVideo && returnVisitVideo.currentTime > maxTime) {
          maxTime = returnVisitVideo.currentTime;
          maxSource = 'returnVisit';
        }
        
        localStorage.setItem('savedVideoTime', maxTime.toString());
        console.log('üíæ Saved MAX video time on page hide from', maxSource, ':', maxTime, 'seconds');
      }
    }
  });

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ–º–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞)
  const vslVideoInline = document.getElementById('vslVideoInline');
  if (vslVideoInline) {
    // –û—Ç–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
    vslVideoInline.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      return false;
    });
    
    // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ - —É–±–∏—Ä–∞–µ–º –≤—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    console.log('‚úÖ Video seeking enabled for vslVideoInline');

    // –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ
    let savedChatVideoTime = 0;
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    const savedTime = localStorage.getItem('savedChatVideoTime');
    if (savedTime) {
      savedChatVideoTime = parseFloat(savedTime);
      console.log('üì∫ Loaded saved chat video time:', savedChatVideoTime);
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function saveChatVideoTime() {
      if (vslVideoInline && vslVideoInline.currentTime > 0) {
        savedChatVideoTime = vslVideoInline.currentTime;
        localStorage.setItem('savedChatVideoTime', savedChatVideoTime.toString());
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∞–º–æ–µ –ø–æ–∑–¥–Ω–µ–µ –≤ savedVideoTime
        const fullscreenVideo = document.getElementById('fullscreenVideo');
        const returnVideo = document.getElementById('returnVslVideo');
        const returnVisitVideo = document.getElementById('returnVisitVideo');
        
        let maxTime = vslVideoInline.currentTime;
        let maxSource = 'chat';
        
        if (fullscreenVideo && fullscreenVideo.currentTime > maxTime) {
          maxTime = fullscreenVideo.currentTime;
          maxSource = 'fullscreen';
        }
        
        if (returnVideo && returnVideo.currentTime > maxTime) {
          maxTime = returnVideo.currentTime;
          maxSource = 'return';
        }
        
        if (returnVisitVideo && returnVisitVideo.currentTime > maxTime) {
          maxTime = returnVisitVideo.currentTime;
          maxSource = 'returnVisit';
        }
        
        localStorage.setItem('savedVideoTime', maxTime.toString());
        
        const minutes = Math.floor(savedChatVideoTime / 60);
        const seconds = Math.floor(savedChatVideoTime % 60);
        console.log(`üíæ Saved chat video time: ${savedChatVideoTime} seconds (${minutes}:${seconds.toString().padStart(2, '0')})`);
        console.log(`üíæ Saved MAX video time from ${maxSource}: ${maxTime} seconds`);
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    setInterval(() => {
      if (vslVideoInline && !vslVideoInline.paused && vslVideoInline.currentTime > 0) {
        saveChatVideoTime();
      }
    }, 5000); // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø—Ä–∏ –ø–∞—É–∑–µ
    vslVideoInline.addEventListener('pause', saveChatVideoTime);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', saveChatVideoTime);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ
    vslVideoInline.addEventListener('loadeddata', () => {
      if (savedChatVideoTime > 0) {
        vslVideoInline.currentTime = savedChatVideoTime;
        console.log('‚è∞ Restored chat video time to:', savedChatVideoTime);
      }
    });

  }



  // Exit intent –æ—Ç–∫–ª—é—á–µ–Ω - –ø–æ–ø–∞–ø –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
  // document.addEventListener('mouseleave', (e) => {
  //   if (e.clientY <= 0 && !hasShownForm && !hasVisitedBefore) {
  //     if (window.showReturnPopup) {
  //       window.showReturnPopup();
  //     }
  //   }
  // });

  // VSL –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª–∏–∫—É
  let hasOpenedVsl = false;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–∞–Ω–µ–µ
  let hasVisitedBefore = localStorage.getItem('hasVisitedBefore');
  
  // –ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç - –∑–∞–ø–æ–º–∏–Ω–∞–µ–º (VSL –≤ —á–∞—Ç–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  if (!hasVisitedBefore) {
    localStorage.setItem('hasVisitedBefore', 'true');
  }

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä –∏ —Å—á–µ—Ç—á–∏–∫ –±–∞–Ω–æ–∫
  let globalTimeLeft = 4 * 60 + 19; // 4 –º–∏–Ω—É—Ç—ã 19 —Å–µ–∫—É–Ω–¥
  let globalBottlesLeft = 39;
  let globalTotalBottles = 1500;
  
  function updateGlobalTimer() {
    const minutes = Math.floor(globalTimeLeft / 60);
    const seconds = globalTimeLeft % 60;
    const timerElements = document.querySelectorAll('#timer, #domonetkaTimer, #orderTimer');
    timerElements.forEach(element => {
      element.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    });
    
    if (globalTimeLeft > 0) {
      globalTimeLeft--;
    }
  }
  
  function updateGlobalBottles() {
    const bottlesElements = document.querySelectorAll('#bottles, #domonetkaBottles');
    bottlesElements.forEach(element => {
      if (globalBottlesLeft > 0) {
        globalBottlesLeft--;
        element.textContent = `${globalBottlesLeft}/${globalTotalBottles}`;
      }
    });
  }
  
  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã (–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
  let globalTimerInterval;
  let globalBottlesInterval;
  let globalTimersStarted = false;
  
  function startGlobalTimers() {
    if (!globalTimersStarted) {
      if (!globalTimerInterval) {
        globalTimerInterval = setInterval(updateGlobalTimer, 1000);
      }
      if (!globalBottlesInterval) {
        globalBottlesInterval = setInterval(updateGlobalBottles, 4000 + Math.random() * 1000);
      }
      globalTimersStarted = true;
    }
  }
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä—ã —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  startGlobalTimers();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É"
  const getDiscountBtn = document.getElementById('getDiscountBtn');
  getDiscountBtn?.addEventListener('click', () => {
    console.log('getDiscountBtn clicked');
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞ –∫–∞–∫ PWA –º–æ–¥–∞–ª
    const orderFormModal = document.getElementById('orderFormModal');
    if (orderFormModal) {
      orderFormModal.style.display = 'flex';
      setTimeout(() => {
        orderFormModal.classList.add('show');
      }, 10);
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º –≤ —á–∞—Ç–µ
  const orderLeadForm = document.getElementById('orderLeadForm');
  const callSubmitBtn = document.getElementById('callSubmitBtn');
  const backToOrderBtn = document.getElementById('backToOrderBtn');

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
  let savedFormData = {};

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
  orderLeadForm?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    console.log('Order form submitted');
    
    const formData = new FormData(orderLeadForm);
    const leadData = {
      ktDomain: "uniaffshark.com",
      ktCampaignId: 10314,
      leadName: formData.get('name'),
      phone: formData.get('phone'),
      calltime: "–ù–µ –≤—ã–±—Ä–∞–Ω–æ",
      timestamp: new Date().toISOString(),
      reason: 'order_form',
      videoWatchTime: videoStartTime ? Math.floor((Date.now() - videoStartTime) / 1000) : 0,
      userAgent: navigator.userAgent
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Ñ–æ—Ä–º—ã
    savedFormData = {
      name: formData.get('name'),
      phone: formData.get('phone'),
      videoWatchTime: videoStartTime ? Math.floor((Date.now() - videoStartTime) / 1000) : 0
    };
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
    const apiResult = await sendLeadToAPI(leadData, 'order_form_submit');
    
    // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
    logLeadData(leadData, 'order_form_submit');
    console.log('Order form submitted successfully');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–≤–æ–Ω–∫–∞
    const orderFormModal = document.getElementById('orderFormModal');
    if (orderFormModal) {
      orderFormModal.classList.remove('show');
      setTimeout(() => {
        orderFormModal.style.display = 'none';
      }, 300);
    }
    
    const callBookingModal = document.getElementById('callBookingModal');
    if (callBookingModal) {
      callBookingModal.style.display = 'flex';
      setTimeout(() => {
        callBookingModal.classList.add('show');
      }, 10);
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–≤–æ–Ω–∫–∞
  callSubmitBtn?.addEventListener('click', async () => {
    const callTimeElement = document.getElementById('callTime');
    const callTime = callTimeElement ? callTimeElement.value : '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
    
    console.log('Selected call time:', callTime);
    console.log('Call time element:', callTimeElement);
    
    const leadData = {
      ktDomain: "uniaffshark.com",
      ktCampaignId: 10314,
      leadName: savedFormData.name || '',
      phone: savedFormData.phone || '',
      calltime: callTime,
      timestamp: new Date().toISOString(),
      reason: 'call_booking',
      videoWatchTime: savedFormData.videoWatchTime || 0,
      userAgent: navigator.userAgent
    };
    
    console.log('Call booking form submitted with data:', leadData);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
    const apiResult = await sendLeadToAPI(leadData, 'call_booking_submit');
    
    // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
    logLeadData(leadData, 'call_booking_submit');
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    const callBookingModal = document.getElementById('callBookingModal');
    if (callBookingModal) {
      callBookingModal.classList.remove('show');
      setTimeout(() => {
        callBookingModal.style.display = 'none';
      }, 300);
    }
    
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ –≤ —á–∞—Ç–µ
      showSuccessMessageInChat(savedFormData.name || '');
    
    // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    savedFormData = {};
    console.log('Call booking form submitted successfully');
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ —Ñ–æ—Ä–º–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  backToOrderBtn?.addEventListener('click', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ù–∞–∑–∞–¥"
    if (savedFormData.name && savedFormData.phone) {
      const callTimeElement = document.getElementById('callTime');
      const callTime = callTimeElement ? callTimeElement.value : '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
      
      const leadData = {
        name: savedFormData.name,
        phone: savedFormData.phone,
        callTime: callTime,
        timestamp: new Date().toISOString(),
        reason: 'call_booking_back_button',
        videoWatchTime: savedFormData.videoWatchTime || 0,
        userAgent: navigator.userAgent
      };
      
      try {
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
        logLeadData(leadData, 'form_interaction');
        console.log('Call booking back button clicked - data sent');
      } catch (error) {
        console.error('Error sending call booking back button data:', error);
      }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ (—á–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç–∞–¥–∏—è)
    if (window.showTimeSelectionPopup) {
      window.showTimeSelectionPopup();
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
  const closeOrderFormModal = document.getElementById('closeOrderFormModal');
  const closeCallBookingModal = document.getElementById('closeCallBookingModal');
  const orderFormBackdrop = document.getElementById('orderFormBackdrop');
  const callBookingBackdrop = document.getElementById('callBookingBackdrop');

  function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏ –±–µ–∑ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
  async function sendAutoCallRequest() {
    const leadData = {
      ktDomain: "uniaffshark.com",
      ktCampaignId: 10314,
      leadName: savedFormData.name || '',
      phone: savedFormData.phone || '',
      calltime: '–ù–µ –≤—ã–±—Ä–∞–Ω–æ',
      timestamp: new Date().toISOString(),
      reason: 'auto_call_booking',
      videoWatchTime: savedFormData.videoWatchTime || 0,
      userAgent: navigator.userAgent
    };
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
    const apiResult = await sendLeadToAPI(leadData, 'call_booking_submit');
    
    // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
    logLeadData(leadData, 'call_booking_submit');
    console.log('Auto call request sent successfully');
  }

  closeOrderFormModal?.addEventListener('click', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
    if (savedFormData.name && savedFormData.phone) {
      const leadData = {
        ktDomain: "uniaffshark.com",
        ktCampaignId: 10314,
        leadName: savedFormData.name,
        phone: savedFormData.phone,
        calltime: '–§–æ—Ä–º–∞ –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º',
        timestamp: new Date().toISOString(),
        reason: 'order_form_closed',
        videoWatchTime: savedFormData.videoWatchTime || 0,
        userAgent: navigator.userAgent
      };
      
      try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
        const apiResult = await sendLeadToAPI(leadData, 'form_interaction');
        
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
        logLeadData(leadData, 'form_interaction');
        console.log('Order form closed - data sent');
      } catch (error) {
        console.error('Error sending order form close data:', error);
      }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å —Ñ–æ—Ä–º—ã (—Ç—Ä–µ—Ç—å—è —Å—Ç–∞–¥–∏—è)
    if (window.showFormReturnPopup) {
      window.showFormReturnPopup();
    }
  });

  closeCallBookingModal?.addEventListener('click', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
    if (savedFormData.name && savedFormData.phone) {
      const callTimeElement = document.getElementById('callTime');
      const callTime = callTimeElement ? callTimeElement.value : '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
      
      const leadData = {
        name: savedFormData.name,
        phone: savedFormData.phone,
        callTime: callTime,
        timestamp: new Date().toISOString(),
        reason: 'call_booking_closed',
        videoWatchTime: savedFormData.videoWatchTime || 0,
        userAgent: navigator.userAgent
      };
      
      try {
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
        logLeadData(leadData, 'form_interaction');
        console.log('Call booking form closed - data sent');
      } catch (error) {
        console.error('Error sending call booking close data:', error);
      }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ (—á–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç–∞–¥–∏—è)
    if (window.showTimeSelectionPopup) {
      window.showTimeSelectionPopup();
    }
  });

  orderFormBackdrop?.addEventListener('click', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
    if (savedFormData.name && savedFormData.phone) {
      const leadData = {
        name: savedFormData.name,
        phone: savedFormData.phone,
        callTime: '–§–æ—Ä–º–∞ –∑–∞–∫—Ä—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º',
        timestamp: new Date().toISOString(),
        reason: 'order_form_backdrop_closed',
        videoWatchTime: savedFormData.videoWatchTime || 0,
        userAgent: navigator.userAgent
      };
      
      try {
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
        logLeadData(leadData, 'form_interaction');
        console.log('Order form backdrop clicked - data sent');
      } catch (error) {
        console.error('Error sending order form backdrop data:', error);
      }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å —Ñ–æ—Ä–º—ã (—Ç—Ä–µ—Ç—å—è —Å—Ç–∞–¥–∏—è)
    if (window.showFormReturnPopup) {
      window.showFormReturnPopup();
    }
  });

  callBookingBackdrop?.addEventListener('click', async () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω —Ñ–æ—Ä–º—ã –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
    if (savedFormData.name && savedFormData.phone) {
      const callTimeElement = document.getElementById('callTime');
      const callTime = callTimeElement ? callTimeElement.value : '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
      
      const leadData = {
        name: savedFormData.name,
        phone: savedFormData.phone,
        callTime: callTime,
        timestamp: new Date().toISOString(),
        reason: 'call_booking_backdrop_closed',
        videoWatchTime: savedFormData.videoWatchTime || 0,
        userAgent: navigator.userAgent
      };
      
      try {
        // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
        logLeadData(leadData, 'form_interaction');
        console.log('Call booking backdrop clicked - data sent');
      } catch (error) {
        console.error('Error sending call booking backdrop data:', error);
      }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ (—á–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç–∞–¥–∏—è)
    if (window.showTimeSelectionPopup) {
      window.showTimeSelectionPopup();
    }
  });





  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º
  const autoMessage = document.getElementById('autoMessage');
  const autoDiscountContainer = document.getElementById('autoDiscountContainer');
  const autoDiscountBtn = document.getElementById('autoDiscountBtn');
  let hasShownAutoMessage = false;

  function showAutoMessage() {
    console.log('üéØ showAutoMessage called');
    if (!hasShownAutoMessage && autoMessage && autoDiscountContainer) {
      console.log('‚úÖ Showing auto message and button');
      autoMessage.style.display = 'block';
      autoDiscountContainer.style.display = 'block';
      hasShownAutoMessage = true;
      
      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
      setTimeout(() => {
        const chatContainer = document.querySelector('.chat');
        if (chatContainer) {
          chatContainer.scrollTop = chatContainer.scrollHeight;
          console.log('üìú Scrolled chat to bottom');
        }
      }, 200);
    } else {
      console.log('‚ö†Ô∏è Auto message already shown or element not found');
    }
  }

  // –£–±–∏—Ä–∞–µ–º –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –æ–∫–Ω–∞ - –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è VSL
  // document.addEventListener('visibilitychange', () => {
  //   if (document.hidden && !hasShownAutoMessage) {
  //     showAutoMessage();
  //   }
  // });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É" –≤ –∞–≤—Ç–æ—Å–æ–æ–±—â–µ–Ω–∏–∏
  autoDiscountBtn?.addEventListener('click', () => {
    console.log('üéØ autoDiscountBtn clicked');
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞ –∫–∞–∫ PWA –º–æ–¥–∞–ª
    const orderFormModal = document.getElementById('orderFormModal');
    if (orderFormModal) {
      orderFormModal.style.display = 'flex';
      setTimeout(() => {
        orderFormModal.classList.add('show');
      }, 10);
    }
  });



  // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è - –æ–Ω–æ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è VSL
  // setTimeout(showAutoMessage, 5000);



  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
  function startAutoplayWithBypass(video) {
    if (!video) return;
    
    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ü—Ä–æ–±—É–µ–º —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤)
    video.muted = true;
    video.play().then(() => {
      console.log('‚úÖ Fullscreen video started playing (muted)');
      // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —Å—Ä–∞–∑—É
      video.muted = false;
      console.log('üîä Sound enabled immediately');
    }).catch((error) => {
      console.log('‚ùå Muted autoplay failed:', error.name);
      
      // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü—Ä–æ–±—É–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
      setTimeout(() => {
        video.muted = true;
        video.play().then(() => {
          console.log('‚úÖ Fullscreen video started playing (delayed muted)');
          // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —Å—Ä–∞–∑—É
          video.muted = false;
          console.log('üîä Sound enabled immediately (delayed)');
        }).catch((error2) => {
          console.log('‚ùå Delayed autoplay failed:', error2.name);
          
          // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ñ–¥–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          setupUserInteractionAutoplay(video);
        });
      }, 500);
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  function setupUserInteractionAutoplay(video) {
    let hasUserInteracted = false;
    
    // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    const playButton = document.createElement('div');
    playButton.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      cursor: pointer;
      z-index: 1000;
    `;
    playButton.innerHTML = `
      <div style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        font-size: 18px;
        text-align: center;
        pointer-events: none;
      ">
        ‚ñ∂Ô∏è –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
      </div>
    `;
    
    playButton.onclick = () => {
      if (!hasUserInteracted) {
        hasUserInteracted = true;
        playButton.remove();
        video.muted = false;
        video.play().then(() => {
          console.log('‚úÖ Fullscreen video started after user interaction');
        }).catch((error) => {
          console.error('‚ùå Failed to play after interaction:', error);
        });
      }
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
    const interactionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
    interactionEvents.forEach(event => {
      playButton.addEventListener(event, () => {
        if (!hasUserInteracted) {
          hasUserInteracted = true;
          playButton.remove();
          video.muted = false;
          video.play().then(() => {
            console.log('‚úÖ Fullscreen video started after user interaction');
          }).catch((error) => {
            console.error('‚ùå Failed to play after interaction:', error);
          });
        }
      });
    });
    
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    if (fullscreenPlayer) {
      fullscreenPlayer.appendChild(playButton);
    }
  }

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–º –ø–ª–µ–µ—Ä–æ–º
  function showFullscreenPlayer() {
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    const fullscreenVideo = document.getElementById('fullscreenVideo');
    
    if (fullscreenPlayer && fullscreenVideo) {
      fullscreenPlayer.style.display = 'flex';
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤–∏–¥–µ–æ
      const savedTime = localStorage.getItem('savedVideoTime');
      if (savedTime) {
        const savedVideoTime = parseFloat(savedTime);
        console.log('üé¨ Setting fullscreen video time to:', savedVideoTime, 'seconds');
        
        // –ñ–¥–µ–º, –ø–æ–∫–∞ –≤–∏–¥–µ–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é
        if (fullscreenVideo.readyState >= 2) {
          // –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è —Å—Ä–∞–∑—É
          fullscreenVideo.currentTime = savedVideoTime;
          console.log('‚úÖ Fullscreen video ready, time set immediately to:', savedVideoTime);
        } else {
          // –í–∏–¥–µ–æ –Ω–µ –≥–æ—Ç–æ–≤–æ, –∂–¥–µ–º —Å–æ–±—ã—Ç–∏—è loadedmetadata
          console.log('‚è≥ Fullscreen video not ready, waiting for loadedmetadata...');
          fullscreenVideo.addEventListener('loadedmetadata', () => {
            fullscreenVideo.currentTime = savedVideoTime;
            console.log('‚úÖ Fullscreen video metadata loaded, time set to:', savedVideoTime);
          }, { once: true });
        }
      } else {
        console.log('üé¨ No saved time found, starting from beginning');
        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–∞—á–∏–Ω–∞–µ–º —Å –Ω–∞—á–∞–ª–∞
        if (fullscreenVideo.readyState >= 2) {
          fullscreenVideo.currentTime = 0;
          console.log('‚úÖ Fullscreen video ready, starting from beginning');
        } else {
          fullscreenVideo.addEventListener('loadedmetadata', () => {
            fullscreenVideo.currentTime = 0;
            console.log('‚úÖ Fullscreen video metadata loaded, starting from beginning');
          }, { once: true });
        }
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ —Å –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–ø–ª–µ—è
      startAutoplayWithBypass(fullscreenVideo);
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ø–∞–ø –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ –¥–ª—è —ç—Ç–æ–≥–æ –≤–∏–¥–µ–æ
      console.log('üé¨ Setting up popup for fullscreenVideo');
      if (window.setupVslTimePopup) {
        console.log('üé¨ Calling window.setupVslTimePopup(fullscreenVideo)...');
        window.setupVslTimePopup(fullscreenVideo);
      } else {
        console.error('‚ùå window.setupVslTimePopup is not defined!');
      }

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞ –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
      fullscreenVideo.addEventListener('ended', function() {
        console.log('üé¨ Fullscreen video ended, showing order form');
        if (window.showOrderFormModal) {
          window.showOrderFormModal();
        }
      });

      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
      const fullscreenTimeInterval = setInterval(() => {
        if (fullscreenVideo && !fullscreenVideo.paused && fullscreenVideo.currentTime > 0) {
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞
          localStorage.setItem('savedVideoTime', fullscreenVideo.currentTime.toString());
          console.log('üíæ Auto-saved fullscreen video time:', fullscreenVideo.currentTime, 'seconds');
          
          // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ –µ—Å–ª–∏ –æ–Ω–æ –±–æ–ª—å—à–µ
          const chatVideo = document.getElementById('vslVideoInline');
          if (chatVideo && chatVideo.currentTime > fullscreenVideo.currentTime) {
            localStorage.setItem('savedVideoTime', chatVideo.currentTime.toString());
            console.log('üíæ Chat video time is later, saved chat time:', chatVideo.currentTime, 'seconds');
          }
        }
      }, 5000); // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

      // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–ª–µ–µ—Ä–∞
      const originalHideFullscreenPlayer = hideFullscreenPlayer;
      hideFullscreenPlayer = function() {
        clearInterval(fullscreenTimeInterval);
        originalHideFullscreenPlayer();
      };
    }
  }
  
  function hideFullscreenPlayer() {
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    const fullscreenVideo = document.getElementById('fullscreenVideo');
    
    console.log('üîç hideFullscreenPlayer called');
    console.log('üîç fullscreenPlayer found:', !!fullscreenPlayer);
    console.log('üîç fullscreenVideo found:', !!fullscreenVideo);
    
    if (fullscreenPlayer && fullscreenVideo) {
      console.log('üîç fullscreenVideo.currentTime:', fullscreenVideo.currentTime);
      console.log('üîç fullscreenVideo.paused:', fullscreenVideo.paused);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
      if (fullscreenVideo.currentTime > 0) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∞–º–æ–µ –ø–æ–∑–¥–Ω–µ–µ
        const chatVideo = document.getElementById('vslVideoInline');
        const returnVideo = document.getElementById('returnVslVideo');
        const returnVisitVideo = document.getElementById('returnVisitVideo');
        
        let maxTime = fullscreenVideo.currentTime;
        let maxSource = 'fullscreen';
        
        if (chatVideo && chatVideo.currentTime > maxTime) {
          maxTime = chatVideo.currentTime;
          maxSource = 'chat';
        }
        
        if (returnVideo && returnVideo.currentTime > maxTime) {
          maxTime = returnVideo.currentTime;
          maxSource = 'return';
        }
        
        if (returnVisitVideo && returnVisitVideo.currentTime > maxTime) {
          maxTime = returnVisitVideo.currentTime;
          maxSource = 'returnVisit';
        }
        
        localStorage.setItem('savedVideoTime', maxTime.toString());
        console.log('üíæ Saved MAX video time from', maxSource, ':', maxTime, 'seconds');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å
        const savedTime = localStorage.getItem('savedVideoTime');
        console.log('üîç Verified saved time in localStorage:', savedTime);
      } else {
        console.log('‚ö†Ô∏è Video time is 0, not saving');
      }
      
      fullscreenPlayer.style.display = 'none';
      fullscreenVideo.pause();
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ VSL –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º –ø–ª–µ–µ—Ä–µ
  function showFullscreenVslMidPopup() {
    console.log('üéØ Showing fullscreen VSL mid popup');
    const popup = document.getElementById('fullscreenVslMidPopup');
    console.log('üéØ Popup element found:', !!popup);
    if (popup) {
      console.log('‚úÖ Fullscreen popup element found, showing...');
      console.log('üéØ Popup current display:', popup.style.display);
      console.log('üéØ Popup current z-index:', popup.style.zIndex);
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø
      popup.style.display = 'block';
      popup.style.opacity = '1';
      popup.style.visibility = 'visible';
      popup.style.zIndex = '1000';
      
      console.log('üéØ Popup display after change:', popup.style.display);
      console.log('üéØ Popup z-index after change:', popup.style.zIndex);
      console.log('‚úÖ Fullscreen popup should now be visible');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –±–∞–Ω–Ω–µ—Ä —Ç–æ–∂–µ –≤–∏–¥–µ–Ω
      const banner = popup.querySelector('.fullscreen-vsl-mid-banner');
      if (banner) {
        console.log('‚úÖ Fullscreen banner element found');
        banner.style.zIndex = '1001';
        console.log('üéØ Fullscreen banner z-index set to:', banner.style.zIndex);
      } else {
        console.error('‚ùå Fullscreen banner element not found!');
      }
    } else {
      console.error('‚ùå Fullscreen popup element not found! fullscreenVslMidPopup does not exist in DOM');
      
      // –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ø–æ—Ö–æ–∂–∏–º–∏ ID
      const allElements = document.querySelectorAll('[id*="popup"]');
      console.log('üéØ All elements with "popup" in ID:', Array.from(allElements).map(el => el.id));
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ mousedown –¥–ª—è VSL –∫–Ω–æ–ø–æ–∫ (–æ—Å–Ω–æ–≤–Ω–æ–π)
  document.addEventListener('mousedown', function(e) {
    if (e.target && (e.target.closest('.vsl-sound-btn') || e.target.id === 'vslPlayBtnSimple')) {
      e.preventDefault();
      e.stopPropagation();
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–µ—Ä
      showFullscreenPlayer();
    }
    
    // –ö–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
    if (e.target && e.target.id === 'vslMuteBtn') {
      e.preventDefault();
      e.stopPropagation();
      toggleVslSound();
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ VSL –≤ —á–∞—Ç–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  document.addEventListener('click', function(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ VSL –≤–∏–¥–µ–æ –∏–ª–∏ –µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –Ω–æ –Ω–µ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –∑–≤—É–∫–∞
    if (e.target && e.target.closest('.vsl-bubble') && 
        !e.target.closest('.vsl-sound-btn') && 
        e.target.id !== 'vslMuteBtn' && 
        e.target.id !== 'vslPlayBtnSimple') {
      console.log('üé¨ VSL bubble clicked!');
      e.preventDefault();
      e.stopPropagation();
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º ReturnPopup —Å VSL
      console.log('üé¨ Trying to show return popup');
      console.log('üé¨ window.showReturnPopup exists:', !!window.showReturnPopup);
      if (window.showReturnPopup) {
        window.showReturnPopup();
      } else {
        console.error('‚ùå window.showReturnPopup is not defined!');
      }
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ –¥–æ–º–æ–Ω–µ—Ç–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –≤–∏–¥–µ–æ, –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∏–≥—Ä–∞–µ—Ç –∏ –Ω–µ—Ç –ø–æ–ø–∞–ø–æ–≤
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –ù–ï –Ω–∞ –≤–∏–¥–µ–æ –∏ –ù–ï –Ω–∞ –ø–æ–ø–∞–ø–∞—Ö
    if (!e.target.closest('.vsl-bubble') && 
        !e.target.closest('.return-popup-backdrop') && 
        !e.target.closest('.return-visit-popup-backdrop') && 
        !e.target.closest('.vsl-exit-popup') && 
        !e.target.closest('.pwa-modal') && 
        !e.target.closest('.domonetka-form')) {
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ –∏ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–ø–∞–ø–æ–≤, –±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ –¥–æ–º–æ–Ω–µ—Ç–∫–∏
      const chatVideo = document.getElementById('vslVideoInline');
      const returnPopup = document.getElementById('returnPopup');
      const returnVisitPopup = document.getElementById('returnVisitPopup');
      const vslExitPopup = document.getElementById('vslExitPopup');
      const orderFormModal = document.getElementById('orderFormModal');
      const callBookingModal = document.getElementById('callBookingModal');
      const domonetkaForm = document.getElementById('domonetkaForm');
      
      if (chatVideo && !chatVideo.paused && 
          (!returnPopup || returnPopup.style.display === 'none') &&
          (!returnVisitPopup || returnVisitPopup.style.display === 'none') &&
          (!vslExitPopup || vslExitPopup.style.display === 'none') &&
          (!orderFormModal || orderFormModal.style.display === 'none') &&
          (!callBookingModal || callBookingModal.style.display === 'none') &&
          (!domonetkaForm || domonetkaForm.style.display === 'none')) {
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ –¥–æ–º–æ–Ω–µ—Ç–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –≤–∏–¥–µ–æ
        e.stopPropagation();
        e.preventDefault();
        console.log('üö´ Blocked domonetka form from showing on click outside video');
        return false;
      }
    }
  }, true); // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture: true –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ click –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  document.addEventListener('click', function(e) {
    if (e.target && (e.target.closest('.vsl-sound-btn') || e.target.id === 'vslPlayBtnSimple')) {
      e.preventDefault();
      e.stopPropagation();
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–µ—Ä
      showFullscreenPlayer();
    }
    
    // –ö–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
    if (e.target && e.target.id === 'vslMuteBtn') {
      e.preventDefault();
      e.stopPropagation();
      toggleVslSound();
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ touchstart –¥–ª—è VSL –≤ —á–∞—Ç–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  document.addEventListener('touchstart', function(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ VSL –≤–∏–¥–µ–æ –∏–ª–∏ –µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –Ω–æ –Ω–µ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –∑–≤—É–∫–∞
    if (e.target && e.target.closest('.vsl-bubble') && 
        !e.target.closest('.vsl-sound-btn') && 
        e.target.id !== 'vslMuteBtn' && 
        e.target.id !== 'vslPlayBtnSimple') {
      e.preventDefault();
      e.stopPropagation();
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º ReturnPopup —Å VSL
      if (window.showReturnPopup) {
        window.showReturnPopup();
      }
    }
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–≤—É–∫–∞ VSL
  document.addEventListener('DOMContentLoaded', function() {
    const muteBtn = document.getElementById('vslMuteBtn');
    
    if (muteBtn) {
      muteBtn.addEventListener('mousedown', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleVslSound();
      });
      
      muteBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleVslSound();
      });
    }
  });

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VSL –≤ —á–∞—Ç–µ
  function startChatVsl() {
    const video = document.getElementById('vslVideoInline');
    if (video) {
      // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
      if (video.readyState === 0) {
        video.load();
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ —Å –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      startChatVslWithBypass(video);
    } else {
      console.error('‚ùå Video element not found in startChatVsl');
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ø–∞–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ª–∏ —ç—Ç–æ –ø–æ—Å–µ—â–µ–Ω–∏–µ
    const hasVisitedBefore = localStorage.getItem('hasVisitedBefore');
    const savedVideoTime = localStorage.getItem('savedVideoTime');
    
    if (hasVisitedBefore && savedVideoTime !== null) {
      console.log('‚úÖ Return visit detected, hasVisitedBefore:', hasVisitedBefore, 'savedVideoTime:', savedVideoTime);
      console.log('üîç All localStorage keys:', Object.keys(localStorage));
      console.log('üîç savedVideoTime value:', localStorage.getItem('savedVideoTime'));
      
      // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π VSL —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
      setTimeout(function() {
        console.log('üé¨ Opening fullscreen VSL with saved time:', savedVideoTime);
        if (window.showFullscreenPlayer) {
          window.showFullscreenPlayer();
        }
      }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è VSL
      
      // –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä
      setTimeout(function() {
        console.log('üé¨ Attempting to show return visit popup after 2 seconds');
        // –ñ–¥–µ–º, –ø–æ–∫–∞ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
        let attempts = 0;
        const maxAttempts = 10;
        
        function tryShowPopup() {
          attempts++;
          console.log('üé¨ Attempt', attempts, 'to show return visit popup');
          if (window.showReturnVisitPopup) {
            console.log('‚úÖ showReturnVisitPopup function found, calling it');
            window.showReturnVisitPopup();
          } else if (attempts < maxAttempts) {
            console.log('‚è≥ showReturnVisitPopup not found, waiting 500ms...');
            setTimeout(tryShowPopup, 500);
          } else {
            console.log('‚ùå Failed to find showReturnVisitPopup after', maxAttempts, 'attempts');
          }
        }
        
        tryShowPopup();
      }, 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø–æ–ø–∞–ø–∞
    } else {
      // –ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç - –∑–∞–ø–æ–º–∏–Ω–∞–µ–º
      localStorage.setItem('hasVisitedBefore', 'true');
    }
    
    // –ñ–¥–µ–º, –ø–æ–∫–∞ ReturnPopup –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ —Å–æ–∑–¥–∞—Å—Ç –≤–∏–¥–µ–æ
    setTimeout(function() {
      const popupVideo = document.getElementById('returnVslVideo');
      if (popupVideo) {
        console.log('‚úÖ Found returnVslVideo element, setting up popup');
        console.log('Video id:', popupVideo.id);
        console.log('Video src:', popupVideo.src);
        console.log('Video currentTime:', popupVideo.currentTime);
        console.log('Video readyState:', popupVideo.readyState);
        console.log('Video paused:', popupVideo.paused);
        console.log('Video duration:', popupVideo.duration);
        setupVslTimePopup(popupVideo);
      } else {
        console.log('‚ö†Ô∏è returnVslVideo not found yet, will try again when popup opens');
      }
    }, 1000);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const allVideos = document.querySelectorAll('video');
    console.log('üìπ Found video elements:', allVideos.length);
    allVideos.forEach((v, index) => {
      console.log(`Video ${index + 1}:`, {
        id: v.id,
        src: v.src,
        preload: v.preload,
        autoplay: v.autoplay,
        muted: v.muted,
        currentTime: v.currentTime,
        readyState: v.readyState,
        paused: v.paused,
        duration: v.duration
      });
    });
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(function() {
      console.log('üîÑ 3 seconds later - checking vslVideoInline again:');
      const videoAgain = document.getElementById('vslVideoInline');
      if (videoAgain) {
        console.log('Video currentTime:', videoAgain.currentTime);
        console.log('Video readyState:', videoAgain.readyState);
        console.log('Video paused:', videoAgain.paused);
      }
    }, 3000);
  });

  function stopChatVsl() {
    const video = document.getElementById('vslVideoInline');
    if (video) {
      video.pause();
    }
  }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ø–∞–ø–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –≤—Ä–µ–º–µ–Ω–∏ VSL
  function setupVslTimePopup(video) {
    console.log('üé¨ setupVslTimePopup called for video:', video.id);
    console.log('üé¨ Video readyState:', video.readyState);
    console.log('üé¨ Video duration:', video.duration);
    console.log('üé¨ Video paused:', video.paused);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≥–æ—Ç–æ–≤–æ –ª–∏ –≤–∏–¥–µ–æ
    if (video.readyState < 1 || isNaN(video.duration)) {
      console.log('üé¨ Video not ready, waiting for metadata...');
      video.addEventListener('loadedmetadata', function() {
        console.log('üé¨ Video metadata loaded, setting up popup now');
        setupVslTimePopupInternal(video);
      });
      return;
    }
    
    setupVslTimePopupInternal(video);
  }
  
  function setupVslTimePopupInternal(video) {
    let popupShown = false;
    let messageShown = false;
    
    // –ß–∏—Ç–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    const startTime = parseInt(video.dataset.popupStart) || 893;
    const endTime = parseInt(video.dataset.popupEnd) || 1100;
    const messageTime = 713; // –ó–∞ 3 –º–∏–Ω—É—Ç—ã –¥–æ –ø–æ–ø–∞–ø–∞ (893 - 180 = 713)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞ 3 –º–∏–Ω—É—Ç—ã –¥–æ –ø–æ–ø–∞–ø–∞
    const expectedMessageTime = startTime - 180; // 3 –º–∏–Ω—É—Ç—ã = 180 —Å–µ–∫—É–Ω–¥
    if (messageTime !== expectedMessageTime) {
      console.warn('‚ö†Ô∏è Message time mismatch! Expected:', expectedMessageTime, 'Got:', messageTime);
    }
    

    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞/—Å–æ–æ–±—â–µ–Ω–∏—è
    function checkTimeAndShowPopup() {
      const currentTime = video.currentTime;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∑–∞ 3 –º–∏–Ω—É—Ç—ã –¥–æ –ø–æ–ø–∞–ø–∞
      if (!messageShown && currentTime >= messageTime) {
        console.log('üí¨ Showing auto message at time:', Math.floor(currentTime));
        if (window.showAutoMessage) {
          window.showAutoMessage();
        }
        messageShown = true;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –µ—Å–ª–∏ –≤—Ä–µ–º—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –∏ –ø–æ–ø–∞–ø –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è
      if (!popupShown && currentTime >= startTime && currentTime <= endTime) {
        console.log('üéØ Showing VSL popup at time:', Math.floor(currentTime));
        showVslMidPopup();
        popupShown = true;
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ
    video.addEventListener('timeupdate', function() {
      checkTimeAndShowPopup();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–º–æ—Ç–∫–∏ –≤–∏–¥–µ–æ (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–º–∞—Ç—ã–≤–∞–µ—Ç)
    video.addEventListener('seeked', function() {
      checkTimeAndShowPopup();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä)
    video.addEventListener('seeking', function() {
      // –ü—É—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    video.addEventListener('loadedmetadata', function() {
      checkTimeAndShowPopup();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                  video.addEventListener('canplay', function() {
                checkTimeAndShowPopup();
              });

              // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞ –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
              video.addEventListener('ended', function() {
                console.log('üé¨ Video ended, showing order form');
                if (window.showOrderFormModal) {
                  window.showOrderFormModal();
                }
              });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –µ—Å–ª–∏ –≤–∏–¥–µ–æ —É–∂–µ –≤ –Ω—É–∂–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    if (video.readyState >= 1) { // HAVE_METADATA –∏–ª–∏ –±–æ–ª—å—à–µ
      checkTimeAndShowPopup();
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 1 —Å–µ–∫—É–Ω–¥—É
    setInterval(function() {
      const currentTime = video.currentTime;
      
      if (video.readyState >= 1) {
        if (currentTime >= startTime && currentTime <= endTime && !popupShown) {
          showVslMidPopup();
          popupShown = true;
        }
      }
    }, 1000);
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ
  function showVslMidPopup() {
    console.log('üéØ showVslMidPopup called');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–æ–µ –≤–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
    const returnVideo = document.getElementById('returnVslVideo');
    const returnVisitVideo = document.getElementById('returnVisitVideo');
    const chatVideo = document.getElementById('vslVideoInline');
    const fullscreenVideo = document.getElementById('fullscreenVideo');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–æ–π –ø–æ–ø–∞–ø –æ—Ç–∫—Ä—ã—Ç
    const returnPopup = document.getElementById('returnPopup');
    const returnVisitPopup = document.getElementById('returnVisitPopup');
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    
    console.log('üéØ returnPopup display:', returnPopup ? returnPopup.style.display : 'not found');
    console.log('üéØ returnVisitPopup display:', returnVisitPopup ? returnVisitPopup.style.display : 'not found');
    console.log('üéØ returnVideo paused:', returnVideo ? returnVideo.paused : 'not found');
    console.log('üéØ returnVisitVideo paused:', returnVisitVideo ? returnVisitVideo.paused : 'not found');
    
    if (returnPopup && returnPopup.style.display === 'flex' && returnVideo) {
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç ReturnPopup
      console.log('üéØ Showing popup in ReturnPopup');
      if (window.showReturnVslMidPopup) {
        window.showReturnVslMidPopup();
      } else {
        console.error('‚ùå showReturnVslMidPopup is not defined!');
      }
    } else if (returnVisitPopup && returnVisitPopup.style.display === 'flex' && returnVisitVideo) {
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç ReturnVisitPopup
      console.log('üéØ Showing popup in ReturnVisitPopup');
      if (window.showReturnVisitVslMidPopup) {
        window.showReturnVisitVslMidPopup();
      } else {
        console.error('‚ùå showReturnVisitVslMidPopup is not defined!');
      }
    } else if (fullscreenPlayer && fullscreenPlayer.style.display === 'flex' && fullscreenVideo) {
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–µ—Ä
      console.log('üéØ Showing popup in fullscreen player');
      if (window.showFullscreenVslMidPopup) {
        window.showFullscreenVslMidPopup();
      } else {
        console.error('‚ùå showFullscreenVslMidPopup is not defined!');
      }
    } else if (chatVideo && !chatVideo.paused) {
      // –ï—Å–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ
      console.log('üéØ Showing popup in chat');
      const popup = document.getElementById('vslMidPopup');
      if (popup) {
        popup.style.display = 'block';
        popup.style.opacity = '1';
        popup.style.visibility = 'visible';
        popup.style.zIndex = '1000';
        
        const banner = popup.querySelector('.vsl-mid-banner');
        if (banner) {
          banner.style.zIndex = '1001';
        }
      }
    } else {
      console.log('‚ö†Ô∏è No suitable popup found to show green banner');
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ VSL –∫–Ω–æ–ø–∫–∏
  function setupVslButtonHandlers() {
    const vslPlayBtn = document.querySelector('.vsl-play-btn');
    const muteBtn = document.getElementById('vslMuteBtn');
    
    if (vslPlayBtn) {
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
      vslPlayBtn.replaceWith(vslPlayBtn.cloneNode(true));
      
      // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
      const newVslPlayBtn = document.querySelector('.vsl-play-btn');
      
      if (newVslPlayBtn) {
        newVslPlayBtn.addEventListener('mousedown', function(e) {
          e.preventDefault();
          e.stopPropagation();
          toggleVslSound();
        });
        
        newVslPlayBtn.addEventListener('touchstart', function(e) {
          e.preventDefault();
          e.stopPropagation();
          toggleVslSound();
        });
      }
    }
    
    if (muteBtn) {
      muteBtn.addEventListener('mousedown', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleVslSound();
      });
      
      muteBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleVslSound();
      });
    }
  }



  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Escape
  document.addEventListener('keydown', async (e) => {
    if (e.key === 'Escape') {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∞—è —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞
      const orderFormModal = document.getElementById('orderFormModal');
      const callBookingModal = document.getElementById('callBookingModal');
      
      if (orderFormModal && orderFormModal.style.display === 'flex') {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ Escape
        if (savedFormData.name && savedFormData.phone) {
          const leadData = {
            name: savedFormData.name,
            phone: savedFormData.phone,
            callTime: '–§–æ—Ä–º–∞ –∑–∞–∫—Ä—ã—Ç–∞ —á–µ—Ä–µ–∑ Escape',
            timestamp: new Date().toISOString(),
            reason: 'order_form_escape_closed',
            videoWatchTime: savedFormData.videoWatchTime || 0,
            userAgent: navigator.userAgent
          };
          
          try {
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
            logLeadData(leadData, 'form_interaction');
            console.log('Order form closed via Escape - data sent');
          } catch (error) {
            console.error('Error sending order form escape data:', error);
          }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å —Ñ–æ—Ä–º—ã
        if (window.showFormReturnPopup) {
          window.showFormReturnPopup();
        }
      } else if (callBookingModal && callBookingModal.style.display === 'flex') {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ Escape
        if (savedFormData.name && savedFormData.phone) {
          const callTimeElement = document.getElementById('callTime');
          const callTime = callTimeElement ? callTimeElement.value : '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
          
          const leadData = {
            name: savedFormData.name,
            phone: savedFormData.phone,
            callTime: callTime,
            timestamp: new Date().toISOString(),
            reason: 'call_booking_escape_closed',
            videoWatchTime: savedFormData.videoWatchTime || 0,
            userAgent: navigator.userAgent
          };
          
          try {
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ (–∑–∞–º–µ–Ω–∞ API)
            logLeadData(leadData, 'form_interaction');
            console.log('Call booking form closed via Escape - data sent');
          } catch (error) {
            console.error('Error sending call booking escape data:', error);
          }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
        if (window.showTimeSelectionPopup) {
          window.showTimeSelectionPopup();
        }
      }
    }
  });



  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤ —á–∞—Ç–µ
  function startChatVslWithBypass(video) {
    if (!video) return;
    
    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ü—Ä–æ–±—É–µ–º —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤)
    video.muted = true;
    video.play().then(() => {
      console.log('‚úÖ Chat VSL started playing (muted)');
      // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —Å—Ä–∞–∑—É
      video.muted = false;
      console.log('üîä Chat VSL sound enabled immediately');
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–µ–æ
      setTimeout(() => {
        if (window.setupVslButtonHandlers) {
          window.setupVslButtonHandlers();
        }
      }, 100);
      
      // –¢–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ä–∞–∑—É
      if (window.setupVslButtonHandlers) {
        window.setupVslButtonHandlers();
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ
      setupVslTimePopup(video);
    }).catch((error) => {
      console.log('‚ùå Chat VSL muted autoplay failed:', error.name);
      
      // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü—Ä–æ–±—É–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
      setTimeout(() => {
        video.muted = true;
        video.play().then(() => {
          console.log('‚úÖ Chat VSL started playing (delayed muted)');
          // –í–∫–ª—é—á–∞–µ–º –∑–≤—É–∫ —Å—Ä–∞–∑—É
          video.muted = false;
          console.log('üîä Chat VSL sound enabled immediately (delayed)');
          
          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
          if (window.setupVslButtonHandlers) {
            window.setupVslButtonHandlers();
          }
          setupVslTimePopup(video);
        }).catch((error2) => {
          console.log('‚ùå Chat VSL delayed autoplay failed:', error2.name);
          
          // –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ñ–¥–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          setupChatVslUserInteraction(video);
        });
      }, 500);
    });
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–∞—Ç VSL –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  function setupChatVslUserInteraction(video) {
    let hasUserInteracted = false;
    
    // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    const playButton = document.createElement('div');
    playButton.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      cursor: pointer;
      z-index: 1000;
    `;
    playButton.innerHTML = `
      <div style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        font-size: 18px;
        text-align: center;
        pointer-events: none;
      ">
        ‚ñ∂Ô∏è –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
      </div>
    `;
    
    const videoContainer = document.querySelector('.vsl-thumb');
    if (videoContainer) {
      videoContainer.appendChild(playButton);
    }
    
    playButton.onclick = () => {
      if (!hasUserInteracted) {
        hasUserInteracted = true;
        playButton.remove();
        video.muted = false;
        video.play().then(() => {
          console.log('‚úÖ Chat VSL started after user interaction');
          
          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
          if (window.setupVslButtonHandlers) {
            window.setupVslButtonHandlers();
          }
          setupVslTimePopup(video);
        }).catch((error) => {
          console.error('‚ùå Failed to play chat VSL after interaction:', error);
        });
      }
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
    const interactionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
    interactionEvents.forEach(event => {
      playButton.addEventListener(event, () => {
        if (!hasUserInteracted) {
          hasUserInteracted = true;
          playButton.remove();
          video.muted = false;
          video.play().then(() => {
            console.log('‚úÖ Chat VSL started after user interaction');
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            if (window.setupVslButtonHandlers) {
              window.setupVslButtonHandlers();
            }
            setupVslTimePopup(video);
          }).catch((error) => {
            console.error('‚ùå Failed to play chat VSL after interaction:', error);
          });
        }
      });
    });
  }

  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
  let hasUserInteracted = false;
  
  function markUserInteraction() {
    if (!hasUserInteracted) {
      hasUserInteracted = true;
      console.log('üëÜ User interaction detected - autoplay should work now');
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
      document.removeEventListener('click', markUserInteraction);
      document.removeEventListener('touchstart', markUserInteraction);
      document.removeEventListener('keydown', markUserInteraction);
      document.removeEventListener('mousedown', markUserInteraction);
    }
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
  document.addEventListener('click', markUserInteraction, { once: true });
  document.addEventListener('touchstart', markUserInteraction, { once: true });
  document.addEventListener('keydown', markUserInteraction, { once: true });
  document.addEventListener('mousedown', markUserInteraction, { once: true });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞
  document.addEventListener('DOMContentLoaded', function() {
    const fullscreenCloseBtn = document.getElementById('fullscreenCloseBtn');
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    
    if (fullscreenCloseBtn) {
      fullscreenCloseBtn.addEventListener('click', function() {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏–π –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
        showVslCloseChoicePopup();
      });
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
    if (fullscreenPlayer) {
      fullscreenPlayer.addEventListener('click', function(e) {
        if (e.target === fullscreenPlayer) {
          hideFullscreenPlayer();
        }
      });
    }
  });

  // Export functions to window
  window.openPopup = openPopup;
  window.toggleVslSound = toggleVslSound;
  window.startChatVsl = startChatVsl;
  window.stopChatVsl = stopChatVsl;
  window.setupVslButtonHandlers = setupVslButtonHandlers;
  window.setupVslTimePopup = setupVslTimePopup;
  window.hasUserInteracted = () => hasUserInteracted;
  window.showFullscreenPlayer = showFullscreenPlayer;
  window.hideFullscreenPlayer = hideFullscreenPlayer;
  window.showFullscreenVslMidPopup = showFullscreenVslMidPopup;
  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫—Ä–µ—Å—Ç–∏–∫–∞ –∏ –ø–æ–ø–∞–ø–∞ –≤—ã–±–æ—Ä–∞
  const vslCloseBtn = document.getElementById('vslCloseBtn');
  const vslRestartBtn = document.getElementById('vslRestartBtn');
  const vslCloseChoicePopup = document.getElementById('vslCloseChoicePopup');
  const continueWatchingChoice = document.getElementById('continueWatchingChoice');
  const returnToChatChoice = document.getElementById('returnToChatChoice');

  vslCloseBtn?.addEventListener('click', () => {
    if (vslCloseChoicePopup) {
      vslCloseChoicePopup.style.display = 'flex';
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–Ω–∞—á–∞–ª–∞"
  vslRestartBtn?.addEventListener('click', () => {
    const video = document.getElementById('vslVideoInline');
    if (video) {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –≤–∏–¥–µ–æ –Ω–∞ –Ω–∞—á–∞–ª–æ
      video.currentTime = 0;
      
      // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
      localStorage.removeItem('savedChatVideoTime');
      
      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ —Å –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      startChatVslWithBypass(video);
      
      console.log('üîÑ Chat video restarted from beginning');
    }
  });

  continueWatchingChoice?.addEventListener('click', () => {
    if (vslCloseChoicePopup) {
      vslCloseChoicePopup.style.display = 'none';
    }
  });

  returnToChatChoice?.addEventListener('click', () => {
    if (vslCloseChoicePopup) {
      vslCloseChoicePopup.style.display = 'none';
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–ª–µ–µ—Ä –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
    const fullscreenPlayer = document.getElementById('fullscreenPlayer');
    if (fullscreenPlayer && fullscreenPlayer.style.display !== 'none') {
      hideFullscreenPlayer();
    }
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø—ã
    const returnPopup = document.getElementById('returnPopup');
    const returnVisitPopup = document.getElementById('returnVisitPopup');
    const returnVideo = document.getElementById('returnVslVideo');
    const returnVisitVideo = document.getElementById('returnVisitVideo');
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –≤ ReturnPopup
    if (returnVideo) {
      returnVideo.pause();
      console.log('üõë Stopped return video when returning to chat');
    }
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –≤ ReturnVisitPopup
    if (returnVisitVideo) {
      returnVisitVideo.pause();
      console.log('üõë Stopped return visit video when returning to chat');
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø—ã
    if (returnPopup) {
      returnPopup.style.display = 'none';
    }
    
    if (returnVisitPopup) {
      returnVisitPopup.style.display = 'none';
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–ø–∞ –≤—ã–±–æ—Ä–∞
  function showVslCloseChoicePopup() {
    if (vslCloseChoicePopup) {
      vslCloseChoicePopup.style.display = 'flex';
    }
  }



  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ –≤ —á–∞—Ç–µ
  function showSuccessMessageInChat(customerName = '') {
    console.log('üéâ Showing success message in chat for:', customerName);
    
    const chatContainer = document.querySelector('.chat');
    if (!chatContainer) {
      console.error('‚ùå Chat container not found');
      return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞
    const callTimeElement = document.getElementById('callTime');
    let callTimeText = '1-2 –º–∏–Ω—É—Ç—ã'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    if (callTimeElement && callTimeElement.value) {
      const selectedTime = callTimeElement.value;
      console.log('üéØ Selected call time:', selectedTime);
      
      if (selectedTime === '–ü—Ä—è–º–æ —Å–µ–π—á–∞—Å') {
        callTimeText = '1-2 –º–∏–Ω—É—Ç—ã';
      } else if (selectedTime === '5 –º–∏–Ω—É—Ç') {
        callTimeText = '5 –º–∏–Ω—É—Ç';
      } else if (selectedTime === '15 –º–∏–Ω—É—Ç') {
        callTimeText = '15 –º–∏–Ω—É—Ç';
      } else if (selectedTime === '30 –º–∏–Ω—É—Ç') {
        callTimeText = '30 –º–∏–Ω—É—Ç';
      }
    }
    
    console.log('üéØ Final call time text:', callTimeText);
    
    // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ
    const successMessage = document.createElement('div');
    successMessage.className = 'bubble success-message';
    successMessage.innerHTML = `
      <div class="specialist-image">
        <img src="/support.png" alt="–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏" class="support-img" style="width: 100% !important; height: auto !important; max-width: 100% !important; max-height: 330px !important;" />
      </div>
      <div class="success-content">
        <span class="success-text">${customerName ? customerName + ' ' : ''}–∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –û–∂–∏–¥–∞–π—Ç–µ –∑–≤–æ–Ω–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ —á–µ—Ä–µ–∑ ${callTimeText}</span>
      </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
    chatContainer.appendChild(successMessage);
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
    setTimeout(() => {
      chatContainer.scrollTop = chatContainer.scrollHeight;
      console.log('üìú Scrolled chat to show success message');
    }, 100);
  }

  window.showVslMidPopup = showVslMidPopup;
  window.showVslCloseChoicePopup = showVslCloseChoicePopup;
  window.showAutoMessage = showAutoMessage;
  window.showSuccessMessageInChat = showSuccessMessageInChat;
  window.savedFormData = savedFormData;
</script>

<style>
  .container {
    /* –°—Ç–∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ global.css */
  }

  .chat {
    background: #e5ddd5;
    background-image: url('/whatsapp_background.png');
    background-repeat: repeat;
    background-size: auto;
    background-position: center;
    flex: 1;
    padding: 10px 8px 100px;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
    min-height: 0; /* –í–∞–∂–Ω–æ –¥–ª—è flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    height: 100%; /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é –≤—ã—Å–æ—Ç—É */
    scroll-behavior: smooth;
  }

  .bubble {
    background: #fff;
    border-radius: 8px;
    padding: 8px 10px;
    margin: 8px 0;
    max-width: 80%;
    font-size: 14px;
    line-height: 1.35;
    box-shadow: 0 1px 0 rgba(0,0,0,.06);
    position: relative;
  }

  .vsl-bubble {
    max-width: 70%;
    margin: 8px auto;
    padding: 0;
  }

  .bubble::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: -8px;
    width: 0;
    height: 0;
    border: 8px solid transparent;
    border-right-color: #fff;
    border-left: 0;
    border-bottom: 0;
    margin-bottom: 8px;
  }

  .bubble.encryption {
    background: #f5f5dc; /* –ñ–µ–ª—Ç–æ–≤–∞—Ç—ã–π —Ñ–æ–Ω –∫–∞–∫ –≤ WhatsApp */
    color: #8b7355; /* –ö–æ—Ä–∏—á–Ω–µ–≤–∞—Ç—ã–π —Ç–µ–∫—Å—Ç */
    font-size: 12px;
    max-width: 90%;
    margin: 4px auto;
    text-align: center;
    border-radius: 12px;
    padding: 8px 12px;
    box-shadow: none;
    border: none;
    opacity: 1;
  }



  .bubble.encryption::after {
    display: none;
  }

  .bubble.urgent {
    background: #fff;
    color: #000;
    font-weight: 400;
    text-align: left;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–∫–∞–∑–µ */
  .bubble.success-message {
    background: #fff;
    border-left: 3px solid #4caf50;
    padding: 8px 10px;
    margin: 8px 0;
    max-width: 80%;
    font-size: 14px;
    line-height: 1.35;
  }

  .specialist-image {
    text-align: center;
    margin-bottom: 8px;
  }

  .bubble.success-message .support-img {
    width: 100% !important;
    height: auto !important;
    border-radius: 4px !important;
    object-fit: cover !important;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;
    display: block !important;
    margin: 0 auto !important;
    max-width: 100% !important;
    max-height: 330px !important;
  }

  .success-content {
    text-align: center;
  }

  .success-text {
    color: #333;
    font-size: 14px;
  }

  /* .bubble.problem {
    background: #fff;
    color: #d32f2f;
    font-weight: 600;
  } */

  .vsl-bubble {
    max-width: 100%;
    cursor: pointer;
  }

  .vsl-bubble::after {
    display: none;
  }

  .vsl-card {
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,.15);
    max-width: 100%;
    cursor: pointer;
    margin: 0;
  }

  .vsl-thumb {
    position: relative;
    display: grid;
    place-items: center;
    height: 500px !important;
    min-height: 500px !important;
    background: #333;
    color: #fff;
    font-weight: 700;
    font-size: 24px;
    overflow: hidden;
  }

  .vsl-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –≤–∏–¥–µ–æ –≤ —á–∞—Ç–µ */
    pointer-events: none;
  }

  /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∞–Ω–∏—è –≤–∏–¥–µ–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
  @media (max-width: 768px) {
    .vsl-video {
      object-fit: contain; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ –æ–±—Ä–µ–∑–∞–Ω–∏—è */
      background: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –ø—É—Å—Ç—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π */
    }
    
    .vsl-thumb {
      height: 300px !important; /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      min-height: 300px !important;
      max-height: 300px !important; /* –§–∏–∫—Å–∏—Ä—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
    }
    
    .vsl-card {
      height: 300px !important; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –∫–∞—Ä—Ç–æ—á–∫–∏ */
      min-height: 300px !important;
      max-height: 300px !important;
    }
  }

  @media (max-width: 480px) {
    .vsl-thumb {
      height: 250px !important; /* –ï—â–µ –º–µ–Ω—å—à–µ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
      min-height: 250px !important;
      max-height: 250px !important; /* –§–∏–∫—Å–∏—Ä—É–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
    }
    
    .vsl-card {
      height: 250px !important; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –∫–∞—Ä—Ç–æ—á–∫–∏ */
      min-height: 250px !important;
      max-height: 250px !important;
    }
  }

  .vsl-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
    gap: 15px;
  }

  .vsl-save-text {
    color: white;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    margin-top: 5px;
  }

  .vsl-placeholder {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
  }

  .vsl-play-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    z-index: 2;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .vsl-play-btn:hover {
    transform: translate(-50%, -50%) scale(1.1);
  }

  .vsl-play-btn svg {
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
  }

  .speaker-icon {
    font-size: 20px;
  }

  .play-text {
    font-size: 14px;
    font-weight: 600;
  }

  .vsl-info {
    padding: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  }

  .vsl-title {
    font-weight: 600;
    color: #333;
  }

  .vsl-hint {
    font-size: 12px;
    color: var(--muted);
  }

  .chat-input {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: #f0f0f0;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-top: 1px solid #ddd;
    border-radius: 0 0 20px 20px;
    z-index: 100;
    height: 60px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
  }

  .input-btn {
    background: #fff;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #54656f;
    flex-shrink: 0;
    transition: background-color 0.2s;
  }

  .input-btn:hover {
    background: #e9edef;
  }

  .input-field-container {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 20px;
    padding: 8px 12px;
    min-height: 40px;
  }

  .chat-input-field {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    font-size: 15px;
    color: #111b21;
    padding: 0;
    margin: 0;
  }

  .chat-input-field::placeholder {
    color: #667781;
  }

  .emoji-btn {
    background: none;
    border: none;
    color: #54656f;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
  }

  .emoji-btn:hover {
    background: #e9edef;
  }

  .input-actions {
    display: flex;
    gap: 4px;
    margin-left: 8px;
  }

  .action-btn {
    background: none;
    border: none;
    color: #54656f;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
    width: 40px;
    height: 40px;
  }

  .action-btn:hover {
    background: #e9edef;
  }

  .popup-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.65);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
  }

  .popup {
    background: #000;
    border-radius: 12px;
    width: min(900px, 92vw);
    aspect-ratio: 16/9;
    position: relative;
    overflow: hidden;
  }

  .popup video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .popup .close {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(255,255,255,.9);
    border-radius: 999px;
    padding: 6px;
    cursor: pointer;
    border: none;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  @media (min-width: 500px) {
    .pwa-modal {
      max-width: 420px;
    }
  }



  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∏–¥–∫–∏ */
  .discount-message {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #fff;
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0;
    box-shadow: 0 4px 16px rgba(0,0,0,.1);
    max-width: 90%;
    position: relative;
  }

  .discount-message::after {
    display: none;
  }

  .discount-message .product-image {
    width: 70px;
    height: 90px;
    flex-shrink: 0;
  }

  .discount-message .product-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 8px;
  }

  .discount-content {
    flex: 1;
  }

  .discount-text {
    margin: 0 0 12px 0;
    font-size: 14px;
    line-height: 1.4;
    color: #333;
    font-weight: 500;
  }

  .discount-text p {
    margin: 0 0 4px 0;
  }

  .discount-text p:last-child {
    margin-bottom: 0;
  }

  .discount-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
    width: 100%;
  }

  .discount-btn:hover {
    background: #0056b3;
  }



  .auto-message {
    max-width: 90%;
    margin: 8px 0;
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 1px 0 rgba(0,0,0,.06);
    position: relative;
  }

  .auto-message::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: -8px;
    width: 0;
    height: 0;
    border: 8px solid transparent;
    border-right-color: #fff;
    border-left: 0;
    border-bottom: 0;
  }

  /* PWA Modal Styles */
  .pwa-modal {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 420px;
    height: 100%;
    z-index: 10000;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .pwa-modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
  }

  .pwa-modal-content {
    position: relative;
    width: 100%;
    background: #fff;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.3);
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    max-height: 80vh;
    overflow: hidden;
  }

  .pwa-modal.show .pwa-modal-content {
    transform: translateY(0);
  }

  .pwa-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px 8px;
    border-bottom: 1px solid #f0f0f0;
  }

  .pwa-modal-handle {
    width: 40px;
    height: 4px;
    background: #ddd;
    border-radius: 2px;
    margin: 0 auto;
  }

  .pwa-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: #666;
    cursor: pointer;
    padding: 4px;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .pwa-modal-close:hover {
    background: #f0f0f0;
  }

  .pwa-modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: calc(80vh - 80px);
  }

  /* Form Styles */
  .form-header {
    text-align: center;
    margin-bottom: 20px;
  }

  .form-title {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin: 0;
  }

  .product-image-section {
    text-align: center;
    margin-bottom: 20px;
  }

  .product-image {
    max-width: 200px;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .timer-section {
    text-align: center;
    margin-bottom: 20px;
  }

  .timer-badge {
    display: inline-block;
    background: linear-gradient(135deg, #ff4444, #ff6666);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 18px;
    box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
  }

  .order-form-fields {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .field-label {
    font-size: 14px;
    font-weight: 600;
    color: #333;
  }

  .form-input {
    padding: 14px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.2s;
    background: #fafafa;
  }

  .form-input:focus {
    outline: none;
    border-color: #25d366;
    background: #fff;
    box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
  }

  .submit-btn {
    background: linear-gradient(135deg, #25d366, #128c7e);
    color: white;
    border: none;
    padding: 16px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
  }

  .submit-btn:hover {
    background: linear-gradient(135deg, #20b358, #0f7a6b);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(37, 211, 102, 0.4);
  }

  .form-disclaimer {
    font-size: 12px;
    color: #666;
    text-align: center;
    line-height: 1.4;
    margin-top: 12px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
  }

  /* Call Booking Styles */
  .call-to-action {
    text-align: center;
    margin-bottom: 24px;
  }

  .call-title {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin: 0 0 8px 0;
    text-transform: uppercase;
  }

  .call-subtitle {
    font-size: 16px;
    color: #666;
    margin: 0;
  }

  .time-selection {
    margin-bottom: 24px;
  }

  .time-dropdown {
    width: 100%;
    padding: 14px;
    border: 2px solid #90ee90;
    border-radius: 12px;
    font-size: 16px;
    background: #f0f8f0;
    color: #333;
    cursor: pointer;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="black" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 14px center;
    background-size: 20px;
    box-sizing: border-box;
    transition: all 0.2s;
  }

  .time-dropdown:focus {
    outline: none;
    border-color: #25d366;
    box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
  }

  .call-submit-btn {
    background: linear-gradient(135deg, #4fc3f7, #25d366);
    color: white;
    border: none;
    padding: 16px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px rgba(79, 195, 247, 0.3);
  }

  .call-submit-btn:hover {
    background: linear-gradient(135deg, #29b6f6, #20b358);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(79, 195, 247, 0.4);
  }

  .back-btn-chat {
    background: #f0f0f0;
    color: #666;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
  }

  .back-btn-chat:hover {
    background: #e0e0e0;
    transform: translateY(-1px);
  }

  /* Mobile optimizations */
  @media (max-width: 768px) {
    .pwa-modal {
      max-width: 100% !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      width: 100% !important;
    }
    
    .pwa-modal-content {
      border-radius: 0 !important;
      width: 100% !important;
    }
    
    .pwa-modal-body {
      padding: 16px;
    }
    
    .form-title {
      font-size: 18px;
    }
    
    .call-title {
      font-size: 18px;
    }
    
    .time-dropdown {
      width: 100% !important;
      max-width: 100% !important;
      position: relative !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      margin: 0 !important;
      padding: 14px !important;
      box-sizing: border-box !important;
    }
    
    .time-dropdown option {
      position: relative !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      width: 100% !important;
      text-align: left !important;
    }
    
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .pwa-modal-body select {
      width: 100% !important;
      max-width: 100% !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      position: relative !important;
    }
    
    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ü–∏–π –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .pwa-modal-body select option {
      position: relative !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      width: 100% !important;
      text-align: left !important;
    }
    
    /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ */
    .time-selection {
      width: 100% !important;
      max-width: 100% !important;
      position: relative !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
      margin: 0 0 24px 0 !important;
      padding: 0 !important;
      box-sizing: border-box !important;
    }
  }

  .reviews-banner {
    padding: 12px;
    margin: 16px 0 0 0;
  }

  .reviews-text {
    font-size: 14px;
    line-height: 1.2;
  }

  .review-item {
    margin-bottom: 16px;
  }

  .review-images {
    padding: 8px;
    gap: 6px;
  }

  .review-content {
    padding: 10px 12px 12px 12px;
  }

  .review-text {
    font-size: 13px;
    line-height: 1.3;
  }

  .rating-stars {
    font-size: 14px;
  }

  .rating-score {
    font-size: 13px;
  }

  .text-review-item {
    padding: 12px;
    margin-bottom: 12px;
  }

  .reviewer-avatar {
    width: 28px;
    height: 28px;
    font-size: 14px;
  }

  .reviewer-name {
    font-size: 13px;
  }

  .review-title {
    font-size: 15px;
  }

  .review-date {
    font-size: 11px;
  }

  .review-verified {
    font-size: 11px;
  }

  .review-text {
    font-size: 13px;
  }

  .review-helpful {
    font-size: 11px;
  }

  .vsl-play-btn svg {
    width: 60px;
    height: 60px;
  }

  .vsl-save-text {
    font-size: 12px;
  }

  .auto-message-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .auto-message .product-image {
    width: 150px;
    height: auto;
    text-align: center;
  }

  .auto-message .product-image img {
    width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .message-text {
    text-align: center;
    font-size: 14px;
    line-height: 1.4;
    color: #333;
    font-weight: 500;
  }



  .message-text p {
    margin: 0 0 4px 0;
  }

  .message-text p:last-child {
    margin-bottom: 0;
  }

  .auto-discount-container {
    max-width: 90%;
    margin: 8px 0;
    text-align: center;
  }

  .auto-discount-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
    width: 100%;
  }

  .auto-discount-btn:hover {
    background: #0056b3;
  }

  /* –ü–ª–∞—à–∫–∞ —Å –æ—Ç–∑—ã–≤–∞–º–∏ –º—É–∂—á–∏–Ω */
  .reviews-banner {
    background: #90EE90;
    border: 2px solid #000;
    border-radius: 12px;
    padding: 16px;
    margin: 20px 0 0 0;
    text-align: center;
  }

  .reviews-text {
    color: #000;
    font-weight: bold;
    font-family: sans-serif;
    font-size: 16px;
    line-height: 1.3;
    margin: 0;
  }

  .reviews-text br {
    display: block;
    content: "";
    margin: 2px 0;
  }

  /* –°–µ–∫—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ */
  .reviews-section {
    margin: 20px 0 0 0;
  }

  .review-item {
    margin-bottom: 20px;
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .review-images {
    display: flex;
    gap: 8px;
    padding: 12px;
  }

  .review-images.single {
    justify-content: center;
  }

  .review-image {
    flex: 1;
    max-width: 50%;
  }

  .review-images.single .review-image {
    max-width: 80%;
  }

  .review-image img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    object-fit: cover;
  }

  .review-content {
    padding: 12px 16px 16px 16px;
  }

  .review-text {
    font-size: 14px;
    line-height: 1.4;
    color: #333;
    margin-bottom: 8px;
    font-weight: 500;
  }

  .review-rating {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .rating-stars {
    color: #FFD700;
    font-size: 16px;
  }

  .rating-score {
    font-weight: bold;
    color: #333;
    font-size: 14px;
  }

  /* –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã */
  .text-reviews-section {
    margin: 20px 0 0 0;
  }

  .text-review-item {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  .reviewer-info {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .reviewer-avatar {
    width: 32px;
    height: 32px;
    background: #f0f0f0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .reviewer-name {
    font-weight: 600;
    color: #333;
    font-size: 14px;
  }

  .review-title {
    font-weight: bold;
    color: #333;
    font-size: 16px;
    margin-bottom: 4px;
  }

  .review-date {
    color: #666;
    font-size: 12px;
    margin-bottom: 2px;
  }

  .review-verified {
    color: #ff6b35;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .review-text {
    color: #333;
    font-size: 14px;
    line-height: 1.4;
    margin-bottom: 8px;
  }

  .review-helpful {
    color: #666;
    font-size: 12px;
    font-style: italic;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ø–∞–ø–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ VSL */
  .vsl-mid-popup {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    pointer-events: none; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–∫–∞—Ç—å —á–µ—Ä–µ–∑ –ø–æ–ø–∞–ø –Ω–∞ –≤–∏–¥–µ–æ */
    background: transparent; /* –£–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ */
  }

  .vsl-mid-banner {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    background: #4CAF50; /* –ú–µ–Ω–µ–µ —è—Ä–∫–∏–π –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç */
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: bold;
    font-size: 16px;
    z-index: 11;
    pointer-events: auto; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–∞–Ω–Ω–µ—Ä–æ–º */
    position: relative;
  }

  .vsl-mid-vignette {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.3) 100%);
    pointer-events: none;
    z-index: 1;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–æ–ø–∞–ø–∞ —Å –≤–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–µ–º ReturnPopup */

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–µ–ª–µ–Ω–æ–π –º–∏–≥–∞—é—â–µ–π –∫–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞ */
  .vsl-sound-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
    cursor: pointer;
  }

  .sound-btn-content {
    background: #4CAF50;
    border: 3px solid #45a049;
    border-radius: 12px;
    padding: 16px 24px;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
    text-align: center;
    min-width: 200px;
    animation: pulse-green 2s infinite;
  }

  .sound-btn-text-top {
    color: white;
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  .sound-btn-text-bottom {
    color: white;
    font-weight: 600;
    font-size: 14px;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  .vsl-sound-btn:hover {
    animation: none;
  }

  .vsl-sound-btn:hover .sound-btn-content {
    animation: none;
    background: #45a049;
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(76, 175, 80, 0.6);
  }

  /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ –≤–ª–∏—è–ª–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
  @keyframes pulse-green {
    0% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.05);
      opacity: 0.9;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ø–∞–ø–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ VSL */
  .vsl-close-choice-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .vsl-close-choice-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .vsl-close-choice-content h3 {
    margin: 0 0 20px 0;
    font-size: 18px;
    color: #333;
  }

  .vsl-close-choice-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .vsl-close-choice-buttons .btn-primary {
    background: linear-gradient(135deg, #ff6b35, #ff4444);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .vsl-close-choice-buttons .btn-primary:hover {
    background: linear-gradient(135deg, #e55a2b, #e53935);
    transform: translateY(-2px);
  }

  .vsl-close-choice-buttons .btn-secondary {
    background: #f5f5f5;
    color: #333;
    border: 2px solid #ddd;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .vsl-close-choice-buttons .btn-secondary:hover {
    background: #e9e9e9;
    border-color: #ccc;
    transform: translateY(-2px);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞ */
  .fullscreen-player {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: transparent; /* –£–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .fullscreen-player-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent; /* –£–±–∏—Ä–∞–µ–º –ª—é–±–æ–π —Ñ–æ–Ω */
  }

  .fullscreen-player video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #000;
  }

  .fullscreen-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    z-index: 1010;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .fullscreen-close-btn:hover {
    background: rgba(0, 0, 0, 0.9);
  }

  /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞ */
  @media (max-width: 768px) {
    .fullscreen-close-btn {
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      font-size: 18px;
    }
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ø–∞–ø–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –º–∏–Ω—É—Ç–µ VSL –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º –ø–ª–µ–µ—Ä–µ */
  .fullscreen-vsl-mid-popup {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    pointer-events: none; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–∫–∞—Ç—å —á–µ—Ä–µ–∑ –ø–æ–ø–∞–ø –Ω–∞ –≤–∏–¥–µ–æ */
    background: transparent; /* –£–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –≤–∏–¥–µ–æ */
  }

  .fullscreen-vsl-mid-banner {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    background: #4CAF50; /* –ú–µ–Ω–µ–µ —è—Ä–∫–∏–π –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç */
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: bold;
    font-size: 16px;
    z-index: 11;
    pointer-events: auto; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–∞–Ω–Ω–µ—Ä–æ–º */
    position: relative;
  }

  .fullscreen-vsl-mid-vignette {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: transparent; /* –£–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
    pointer-events: none;
    z-index: 1;
  }

</style>


